/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
'use strict';var f,aa=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}},ba="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a},ca=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");
},p=ca(this),r=function(a,b){if(b)a:{var c=p;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ba(c,a,{configurable:!0,writable:!0,value:b})}};
r("Symbol",function(a){if(a)return a;var b=function(g,h){this.$jscomp$symbol$id_=g;ba(this,"description",{configurable:!0,writable:!0,value:h})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",d=0,e=function(g){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b(c+(g||"")+"_"+d++,g)};return e},"es6","es3");
r("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=p[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&ba(d.prototype,a,{configurable:!0,writable:!0,value:function(){return da(aa(this))}})}return a},"es6","es3");
var da=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a},u=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}},ea="function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b},fa;
if("function"==typeof Object.setPrototypeOf)fa=Object.setPrototypeOf;else{var ha;a:{var ia={a:!0},ja={};try{ja.__proto__=ia;ha=ja.a;break a}catch(a){}ha=!1}fa=ha?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}
var ka=fa,la=function(a,b){a.prototype=ea(b.prototype);a.prototype.constructor=a;if(ka)ka(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype},ma=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");},na=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=
this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};f=na.prototype;f.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};f.stop_=function(){this.isRunning_=!1};f.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};f.JSC$2667_next_=function(a){this.yieldResult=a};f.JSC$2667_throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};
f.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};f.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};f.yield=function(a,b){this.nextAddress=b;return{value:a}};f.yieldAll=function(a,b){a=u(a);var c=a.next();ma(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};f.jumpTo=function(a){this.nextAddress=a};
f.jumpToEnd=function(){this.nextAddress=0};f.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};f.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};f.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};f.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};
f.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
f.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};f.forIn=function(a){return new oa(a)};var oa=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};
oa.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};var pa=function(a){this.context_=new na;this.program_=a};f=pa.prototype;f.JSC$2679_next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.JSC$2667_next_);this.context_.JSC$2667_next_(a);return this.nextStep_()};
f.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};f.JSC$2679_throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.JSC$2667_next_);this.context_.JSC$2667_throw_(a);return this.nextStep_()};
f.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);ma(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.JSC$2667_throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
f.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.JSC$2667_throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
var qa=function(a){this.next=function(b){return a.JSC$2679_next_(b)};this.throw=function(b){return a.JSC$2679_throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}},ra=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function g(h){h.done?d(h.value):Promise.resolve(h.value).then(b,c).then(g,e)}g(a.next())})},v=function(a){return ra(new qa(new pa(a)))};
r("Promise",function(a){function b(){this.batch_=null}function c(h){return h instanceof e?h:new e(function(l){l(h)})}if(a)return a;b.prototype.asyncExecute=function(h){if(null==this.batch_){this.batch_=[];var l=this;this.asyncExecuteFunction(function(){l.executeBatch_()})}this.batch_.push(h)};var d=p.setTimeout;b.prototype.asyncExecuteFunction=function(h){d(h,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var h=this.batch_;this.batch_=[];for(var l=0;l<h.length;++l){var k=
h[l];h[l]=null;try{k()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};b.prototype.asyncThrow_=function(h){this.asyncExecuteFunction(function(){throw h;})};var e=function(h){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var l=this.createResolveAndReject_();try{h(l.resolve,l.reject)}catch(k){l.reject(k)}};e.prototype.createResolveAndReject_=function(){function h(m){return function(n){k||(k=!0,m.call(l,n))}}var l=this,k=!1;return{resolve:h(this.resolveTo_),
reject:h(this.reject_)}};e.prototype.resolveTo_=function(h){if(h===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(h instanceof e)this.settleSameAsPromise_(h);else{a:switch(typeof h){case "object":var l=null!=h;break a;case "function":l=!0;break a;default:l=!1}l?this.resolveToNonPromiseObj_(h):this.fulfill_(h)}};e.prototype.resolveToNonPromiseObj_=function(h){var l=void 0;try{l=h.then}catch(k){this.reject_(k);return}"function"==typeof l?this.settleSameAsThenable_(l,
h):this.fulfill_(h)};e.prototype.reject_=function(h){this.settle_(2,h)};e.prototype.fulfill_=function(h){this.settle_(1,h)};e.prototype.settle_=function(h,l){if(0!=this.state_)throw Error("Cannot settle("+h+", "+l+"): Promise already settled in state"+this.state_);this.state_=h;this.result_=l;2===this.state_&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};e.prototype.scheduleUnhandledRejectionCheck_=function(){var h=this;d(function(){if(h.notifyUnhandledRejection_()){var l=
p.console;"undefined"!==typeof l&&l.error(h.result_)}},1)};e.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var h=p.CustomEvent,l=p.Event,k=p.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof h?h=new h("unhandledrejection",{cancelable:!0}):"function"===typeof l?h=new l("unhandledrejection",{cancelable:!0}):(h=p.document.createEvent("CustomEvent"),h.initCustomEvent("unhandledrejection",!1,!0,h));h.promise=this;h.reason=this.result_;return k(h)};
e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var h=0;h<this.onSettledCallbacks_.length;++h)g.asyncExecute(this.onSettledCallbacks_[h]);this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(h){var l=this.createResolveAndReject_();h.callWhenSettled_(l.resolve,l.reject)};e.prototype.settleSameAsThenable_=function(h,l){var k=this.createResolveAndReject_();try{h.call(l,k.resolve,k.reject)}catch(m){k.reject(m)}};e.prototype.then=
function(h,l){function k(y,t){return"function"==typeof y?function(D){try{m(y(D))}catch(w){n(w)}}:t}var m,n,q=new e(function(y,t){m=y;n=t});this.callWhenSettled_(k(h,m),k(l,n));return q};e.prototype.catch=function(h){return this.then(void 0,h)};e.prototype.callWhenSettled_=function(h,l){function k(){switch(m.state_){case 1:h(m.result_);break;case 2:l(m.result_);break;default:throw Error("Unexpected state: "+m.state_);}}var m=this;null==this.onSettledCallbacks_?g.asyncExecute(k):this.onSettledCallbacks_.push(k);
this.isRejectionHandled_=!0};e.resolve=c;e.reject=function(h){return new e(function(l,k){k(h)})};e.race=function(h){return new e(function(l,k){for(var m=u(h),n=m.next();!n.done;n=m.next())c(n.value).callWhenSettled_(l,k)})};e.all=function(h){var l=u(h),k=l.next();return k.done?c([]):new e(function(m,n){function q(D){return function(w){y[D]=w;t--;0==t&&m(y)}}var y=[],t=0;do y.push(void 0),t++,c(k.value).callWhenSettled_(q(y.length-1),n),k=l.next();while(!k.done)})};return e},"es6","es3");
var sa=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""},x=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
r("WeakMap",function(a){function b(){}function c(k){var m=typeof k;return"object"===m&&null!==k||"function"===m}function d(k){if(!x(k,g)){var m=new b;ba(k,g,{value:m})}}function e(k){var m=Object[k];m&&(Object[k]=function(n){if(n instanceof b)return n;Object.isExtensible(n)&&d(n);return m(n)})}if(function(){if(!a||!Object.seal)return!1;try{var k=Object.seal({}),m=Object.seal({}),n=new a([[k,2],[m,3]]);if(2!=n.get(k)||3!=n.get(m))return!1;n.delete(k);n.set(m,4);return!n.has(k)&&4==n.get(m)}catch(q){return!1}}())return a;
var g="$jscomp_hidden_"+Math.random();e("freeze");e("preventExtensions");e("seal");var h=0,l=function(k){this.id_=(h+=Math.random()+1).toString();if(k){k=u(k);for(var m;!(m=k.next()).done;)m=m.value,this.set(m[0],m[1])}};l.prototype.set=function(k,m){if(!c(k))throw Error("Invalid WeakMap key");d(k);if(!x(k,g))throw Error("WeakMap key fail: "+k);k[g][this.id_]=m;return this};l.prototype.get=function(k){return c(k)&&x(k,g)?k[g][this.id_]:void 0};l.prototype.has=function(k){return c(k)&&x(k,g)&&x(k[g],
this.id_)};l.prototype.delete=function(k){return c(k)&&x(k,g)&&x(k[g],this.id_)?delete k[g][this.id_]:!1};return l},"es6","es3");
r("Map",function(a){if(function(){if(!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var l=Object.seal({x:4}),k=new a(u([[l,"s"]]));if("s"!=k.get(l)||1!=k.size||k.get({x:4})||k.set({x:4},"t")!=k||2!=k.size)return!1;var m=k.entries(),n=m.next();if(n.done||n.value[0]!=l||"s"!=n.value[1])return!1;n=m.next();return n.done||4!=n.value[0].x||"t"!=n.value[1]||!m.next().done?!1:!0}catch(q){return!1}}())return a;var b=new WeakMap,c=function(l){this.data_={};this.head_=
g();this.size=0;if(l){l=u(l);for(var k;!(k=l.next()).done;)k=k.value,this.set(k[0],k[1])}};c.prototype.set=function(l,k){l=0===l?0:l;var m=d(this,l);m.list||(m.list=this.data_[m.id]=[]);m.entry?m.entry.value=k:(m.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:l,value:k},m.list.push(m.entry),this.head_.previous.next=m.entry,this.head_.previous=m.entry,this.size++);return this};c.prototype.delete=function(l){l=d(this,l);return l.entry&&l.list?(l.list.splice(l.index,1),l.list.length||
delete this.data_[l.id],l.entry.previous.next=l.entry.next,l.entry.next.previous=l.entry.previous,l.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=g();this.size=0};c.prototype.has=function(l){return!!d(this,l).entry};c.prototype.get=function(l){return(l=d(this,l).entry)&&l.value};c.prototype.entries=function(){return e(this,function(l){return[l.key,l.value]})};c.prototype.keys=function(){return e(this,function(l){return l.key})};c.prototype.values=
function(){return e(this,function(l){return l.value})};c.prototype.forEach=function(l,k){for(var m=this.entries(),n;!(n=m.next()).done;)n=n.value,l.call(k,n[1],n[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var d=function(l,k){var m=k&&typeof k;"object"==m||"function"==m?b.has(k)?m=b.get(k):(m=""+ ++h,b.set(k,m)):m="p_"+k;var n=l.data_[m];if(n&&x(l.data_,m))for(l=0;l<n.length;l++){var q=n[l];if(k!==k&&q.key!==q.key||k===q.key)return{id:m,list:n,index:l,entry:q}}return{id:m,list:n,index:-1,
entry:void 0}},e=function(l,k){var m=l.head_;return da(function(){if(m){for(;m.head!=l.head_;)m=m.previous;for(;m.next!=m.head;)return m=m.next,{done:!1,value:k(m)};m=null}return{done:!0,value:void 0}})},g=function(){var l={};return l.previous=l.next=l.head=l},h=0;return c},"es6","es3");r("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
r("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var g=d[c];if(g===b||Object.is(g,b))return!0}return!1}},"es7","es3");r("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==sa(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
r("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=sa(this,b,"startsWith");b+="";var e=d.length,g=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var h=0;h<g&&c<e;)if(d[c++]!=b[h++])return!1;return h>=g}},"es6","es3");
r("Array.from",function(a){return a?a:function(b,c,d){c=null!=c?c:function(l){return l};var e=[],g="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];if("function"==typeof g){b=g.call(b);for(var h=0;!(g=b.next()).done;)e.push(c.call(d,g.value,h++))}else for(g=b.length,h=0;h<g;h++)e.push(c.call(d,b[h],h));return e}},"es6","es3");
r("String.prototype.repeat",function(a){return a?a:function(b){var c=sa(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");r("String.prototype.padStart",function(a){return a?a:function(b,c){var d=sa(this,null,"padStart");b-=d.length;c=void 0!==c?String(c):" ";return(0<b&&c?c.repeat(Math.ceil(b/c.length)).substring(0,b):"")+d}},"es8","es3");
var ta=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var g=c++;return{value:b(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};r("Array.prototype.keys",function(a){return a?a:function(){return ta(this,function(b){return b})}},"es6","es3");r("Array.prototype.values",function(a){return a?a:function(){return ta(this,function(b,c){return c})}},"es8","es3");
var ua=this||self,z=function(a,b,c,d){a=a.split(".");d=d||ua;a[0]in d||"undefined"==typeof d.execScript||d.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)if(a.length||void 0===b)d[e]&&d[e]!==Object.prototype[e]?d=d[e]:d=d[e]={};else if(!c&&va(b)&&va(d[e]))for(var g in b)b.hasOwnProperty(g)&&(d[e][g]=b[g]);else d[e]=b},A=function(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"},wa=function(a){var b=A(a);return"array"==b||"object"==b&&"number"==typeof a.length},
va=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b},xa=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(d,e,g){for(var h=Array(arguments.length-2),l=2;l<arguments.length;l++)h[l-2]=arguments[l];return b.prototype[e].apply(d,h)}},ya=function(a){return a};function B(a,b){if(Error.captureStackTrace)Error.captureStackTrace(this,B);else{var c=Error().stack;c&&(this.stack=c)}a&&(this.message=String(a));void 0!==b&&(this.JSC$2723_cause=b);this.reportErrorToServer=!0}xa(B,Error);B.prototype.name="CustomError";var za=function(a,b){for(var c=a.split("%s"),d="",e=c.length-1,g=0;g<e;g++)d+=c[g]+(g<b.length?b[g]:"%s");B.call(this,d+c[e]);this.messagePattern=a};xa(za,B);za.prototype.name="AssertionError";
var Aa=function(a,b,c,d){var e="Assertion failed";if(c){e+=": "+c;var g=d}else a&&(e+=": "+a,g=b);throw new za(""+e,g||[]);},C=function(a,b,c){a||Aa("",null,b,Array.prototype.slice.call(arguments,2));return a},E=function(a,b){throw new za("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));},F=function(a,b,c){"number"!==typeof a&&Aa("Expected number but got %s: %s.",[A(a),a],b,Array.prototype.slice.call(arguments,2));return a},Ba=function(a,b,c){"string"!==typeof a&&Aa("Expected string but got %s: %s.",
[A(a),a],b,Array.prototype.slice.call(arguments,2));return a};var G=function(a,b){this.stringConstValueWithSecurityContract__googStringSecurityPrivate_=a===Ca&&b||"";this.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_=Da};G.prototype.implementsGoogStringTypedString=!0;G.prototype.getTypedStringValue=function(){return this.stringConstValueWithSecurityContract__googStringSecurityPrivate_};G.prototype.toString=function(){return"Const{"+this.stringConstValueWithSecurityContract__googStringSecurityPrivate_+"}"};
var H=function(a){if(a instanceof G&&a.constructor===G&&a.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_===Da)return a.stringConstValueWithSecurityContract__googStringSecurityPrivate_;E("expected object of type Const, got '"+a+"'");return"type_error:Const"},I=function(a){return new G(Ca,a)},Da={},Ca={};var Ea,Fa=function(){if(void 0===Ea){var a=null,b=ua.trustedTypes;if(b&&b.createPolicy){try{a=b.createPolicy("goog#html",{createHTML:ya,createScript:ya,createScriptURL:ya})}catch(c){ua.console&&ua.console.error(c.message)}Ea=a}else Ea=a}return Ea};var Ga={},J=function(a,b){this.privateDoNotAccessOrElseSafeScriptWrappedValue_=b===Ga?a:"";this.implementsGoogStringTypedString=!0};J.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeScriptWrappedValue_.toString()};var Ha=function(a){if(a instanceof J&&a.constructor===J)return a.privateDoNotAccessOrElseSafeScriptWrappedValue_;E("expected object of type SafeScript, got '"+a+"' of type "+A(a));return"type_error:SafeScript"};J.prototype.toString=function(){return this.privateDoNotAccessOrElseSafeScriptWrappedValue_.toString()};var K=function(a,b){this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_=b===Ia?a:""};f=K.prototype;f.implementsGoogStringTypedString=!0;f.getTypedStringValue=function(){return this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_.toString()};f.implementsGoogI18nBidiDirectionalString=!0;f.getDirection=function(){return 1};f.cloneWithParams=function(a,b){var c=Ja(this).toString();c=Ka.exec(c);var d=c[3]||"";return La(c[1]+Ma("?",c[2]||"",a)+Ma("#",d,b))};
f.toString=function(){return this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_+""};
var Ja=function(a){if(a instanceof K&&a.constructor===K)return a.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_;E("expected object of type TrustedResourceUrl, got '"+a+"' of type "+A(a));return"type_error:TrustedResourceUrl"},Ka=/^([^?#]*)(\?[^#]*)?(#[\s\S]*)?/,Ia={},La=function(a){var b=Fa();a=b?b.createScriptURL(a):a;return new K(a,Ia)},Ma=function(a,b,c){if(null==c)return b;if("string"===typeof c)return c?a+encodeURIComponent(c):"";for(var d in c)if(Object.prototype.hasOwnProperty.call(c,
d)){var e=c[d];e=Array.isArray(e)?e:[e];for(var g=0;g<e.length;g++){var h=e[g];null!=h&&(b||(b=a),b+=(b.length>a.length?"&":"")+encodeURIComponent(d)+"="+encodeURIComponent(String(h)))}}return b};var Na=/&/g,Oa=/</g,Pa=/>/g,Qa=/"/g,Ra=/'/g,Sa=/\x00/g,Ta=/[\x00&<>"']/;var Va=function(a,b){this.privateDoNotAccessOrElseSafeUrlWrappedValue_=b===Ua?a:""};f=Va.prototype;f.implementsGoogStringTypedString=!0;f.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeUrlWrappedValue_.toString()};f.implementsGoogI18nBidiDirectionalString=!0;f.getDirection=function(){return 1};f.toString=function(){return this.privateDoNotAccessOrElseSafeUrlWrappedValue_.toString()};
var Wa=function(a){if(a instanceof Va&&a.constructor===Va)return a.privateDoNotAccessOrElseSafeUrlWrappedValue_;E("expected object of type SafeUrl, got '"+a+"' of type "+A(a));return"type_error:SafeUrl"},Ua={};var Xa={},Ya=function(a,b){this.privateDoNotAccessOrElseSafeStyleWrappedValue_=b===Xa?a:"";this.implementsGoogStringTypedString=!0};Ya.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_};Ya.prototype.toString=function(){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_.toString()};
var Za=function(a){if(a instanceof Ya&&a.constructor===Ya)return a.privateDoNotAccessOrElseSafeStyleWrappedValue_;E("expected object of type SafeStyle, got '"+a+"' of type "+A(a));return"type_error:SafeStyle"};var $a=Array.prototype.indexOf?function(a,b,c){C(null!=a.length);return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var ab={},L=function(a,b,c){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_=c===ab?a:"";this.dir_=b;this.implementsGoogStringTypedString=this.implementsGoogI18nBidiDirectionalString=!0};L.prototype.getDirection=function(){return this.dir_};L.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_.toString()};L.prototype.toString=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_.toString()};
var bb=function(a){if(a instanceof L&&a.constructor===L)return a.privateDoNotAccessOrElseSafeHtmlWrappedValue_;E("expected object of type SafeHtml, got '"+a+"' of type "+A(a));return"type_error:SafeHtml"},cb=function(a,b){var c=Fa();a=c?c.createHTML(a):a;return new L(a,b,ab)};z("ng.safehtml.googSceHelper.isGoogHtmlType",function(a){return a&&a.implementsGoogStringTypedString?!0:!1},!0,void 0);z("ng.safehtml.googSceHelper.isCOMPILED",function(){return!0},!0,void 0);z("ng.safehtml.googSceHelper.unwrapAny",function(a){if(a instanceof K)return Ja(a).toString();if(a instanceof L)return bb(a).toString();if(a instanceof Va)return Wa(a);if(a instanceof Ya)return Za(a);if(a instanceof J)return Ha(a).toString();throw Error();},!0,void 0);
z("ng.safehtml.googSceHelper.unwrapGivenContext",function(a,b){if("html"==a)return bb(b).toString();if("resourceUrl"==a||"templateUrl"==a)return Ja(b).toString();if("url"==a)return b instanceof K?Ja(b).toString():Wa(b);if("css"==a)return Za(b);if("js"==a)return Ha(b).toString();throw Error();},!0,void 0);var M=["NONE","ERROR","WARNING","INFO","DEBUG"],db={cep_proxy_url:!0,enable_auto_enrollment:!0,enable_certificate_renewal:!0,allow_machine_cert_enrollment:!0,user_enrollment_templates:!0,device_enrollment_templates:!0,placeholder_values:!0,company_info:!0,log_level:!0,user_cert_request_values:!0,device_cert_request_values:!0,signature_algo:!0,pending_ui_enabled:!0,renew_hours_before_expiry:!0,renew_reminder_interval:!0,request_timeout_seconds:!0,va_api_key:!0,va_enabled:!0,va_google_url:!0,va_shared_secret:!0,
va_request_timeout_seconds:!0,service_account_name:!0,service_account_password:!0,client_authentication:!0,use_key_based_renewal:!0,ces_renewal_url:!0,service_account_host:!0,service_account_host_password_mask:!0},N=M.indexOf("ERROR"),eb=M.indexOf("WARNING"),O=M.indexOf("INFO"),P=M.indexOf("DEBUG"),fb="",Q=function(a,b,c){0<b&&b<=c&&b<M.length&&(a=M[b]+": "+a,console.log(a),fb+="\n"+a)},gb=function(a){var b="";a=new Uint8Array(a);for(var c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},hb=
function(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c},ib=function(a,b){var c="";a=a.getElementsByTagName(b);null!=a&&void 0!=a&&0!=a.length&&(c=a[a.length-1].innerHTML);if(null==c||void 0==c)c="";return c},jb=function(a){return new Promise(function(b,c){try{chrome.enterprise.platformKeys.getCertificates(a,function(d){chrome.runtime.lastError?c(chrome.runtime.lastError):b(d)})}catch(d){c(d)}})},kb=function(){return new Promise(function(a,
b){try{chrome.storage.local.get("ignored_renewal_requests",function(c){c&&c.ignored_renewal_requests?a(c.ignored_renewal_requests):a([])})}catch(c){b(c)}})},nb=function(a,b,c){var d,e;return v(function(g){if(1==g.nextAddress)return g.yield(lb(a),2);if(d=g.yieldResult)return g.return();e=a.notAfter.value;0<b&&e.setHours(e.getHours()-b);chrome.alarms.create(mb(a),{when:e.getTime(),periodInMinutes:60*c});g.jumpToEnd()})},lb=function(a){var b;return v(function(c){b=mb(a);return c.return(new Promise(function(d,
e){chrome.alarms.get(b,function(g){chrome.runtime.lastError?e(chrome.runtime.lastError):d(void 0!=g?!0:!1)})}))})},ob=function(a){var b,c,d,e,g,h,l,k,m,n;return v(function(q){if(1==q.nextAddress)return b=null,q.yield(kb(),2);if(3!=q.nextAddress)return c=q.yieldResult,0<c.length&&Q("The following certificates are explicitly ignored for renewal by the user: "+c.join("\n"),P,P),q.yield(jb(a),3);d=q.yieldResult;e=u(d);for(g=e.next();!g.done;g=e.next())if(h=g.value,l=window.org.pkijs.fromBER(h),k=new window.org.pkijs.simpl.CERT({schema:l.result}),
null==b||b.notAfter.value<k.notAfter.value)c.includes(mb(k))||(b=k);if(!b)return q.return(null);m=new Date;n=b.notAfter.value;return n<m?q.return(null):q.return(b)})},pb=function(a){var b,c,d,e;return v(function(g){if(1==g.nextAddress)return b="user",g.yield(ob("user"),2);if(3!=g.nextAddress)return d=c=g.yieldResult,a?g.yield(ob("system"),3):d?g.return({slot:b,cert:d}):g.return(null);(e=g.yieldResult)&&(!c||e.notAfter.value<c.notAfter.value)&&(b="system",d=e);return d?g.return({slot:b,cert:d}):g.return(null)})},
rb=function(a,b,c){chrome.enterprise&&pb(a).then(function(d){d?(nb(d.cert,b,c),qb(d.cert,b)):Q("No valid certificate found for renewal",P,P)})},qb=function(a,b){if(sb(a,new Date,b))Q("Certificate is still valid beyond configured offset.",P,P);else{Q("Certificate will expire before configured offset.",P,P);a=mb(a);b=[];var c={};c.title=chrome.i18n.getMessage("renewal_notification_remind");b.push(c);c={};c.title=chrome.i18n.getMessage("renewal_notification_ignore");b.push(c);chrome.notifications.create(a,
{type:"basic",title:chrome.i18n.getMessage("renewal_notification_title"),iconUrl:"img/128.png",message:chrome.i18n.getMessage("renewal_notification_message"),buttons:b},function(){})}},sb=function(a,b,c){return a.notAfter.value.setHours(a.notAfter.value.getHours()-(void 0===c?0:c))>b},mb=function(a){return(new Uint8Array(a.serialNumber.value_block.value_hex)).toString()},tb=function(a,b){return a.replace(/\${(.+?)(:"(.+?)")?}/g,function(c,d,e,g){c=d.split(":");for(d=0;d<c.length;++d)if(e=c[d],e in
b&&b[e])return b[e];return g?g:""})},ub=function(a){for(var b=0;b<a.children.length;++b){var c=a.children[b];c.hasAttribute("id")&&c.getAttribute("id").startsWith("ccr-")&&c.removeAttribute("id");c.children.length&&ub(c)}},R=function(a){a=a.replace(/\s+/g," ").trim();a=a.replace(/>\s*/g,">");return a=a.replace(/\s*</g,"<")},vb=function(a){return Array.from(a).map(function(b){return b.toString(16).padStart(2,"0")}).join("")},xb=function(a){return 0==a.length?new Uint8Array(0):0!=a.length%2||null==
a.match("^[0-9a-f]*$")?null:new Uint8Array(a.match(/.{1,2}/g).map(function(b){return parseInt(b,16)}))},yb=function(a){var b,c,d,e,g,h,l,k,m;return v(function(n){switch(n.nextAddress){case 1:return n.yield(window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),2);case 2:return b=n.yieldResult,c=new Uint8Array(16),window.crypto.getRandomValues(c),d=(new TextEncoder).encode(a),e=Uint8Array,n.yield(crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:128},b,d),3);case 3:return g=
new e(n.yieldResult),h=vb(c)+vb(g),l=Uint8Array,n.yield(window.crypto.subtle.exportKey("raw",b),4);case 4:return k=new l(n.yieldResult),m=vb(k),n.return({mask:m,masked:h})}})},zb=function(a){var b,c,d,e,g;return v(function(h){if(1==h.nextAddress)return b=xb(a.mask),h.yield(window.crypto.subtle.importKey("raw",b.buffer,{name:"AES-GCM"},!0,["decrypt"]),2);if(3!=h.nextAddress)return c=h.yieldResult,d=xb(a.masked.slice(0,32)),e=xb(a.masked.slice(32)),h.yield(window.crypto.subtle.decrypt({name:"AES-GCM",
iv:d.buffer,tagLength:128},c,e.buffer),3);g=h.yieldResult;return h.return((new TextDecoder).decode(g))})},Ab=function(a,b,c){var d,e;return v(function(g){switch(g.nextAddress){case 1:if(!a){g.jumpTo(2);break}return g.yield(ob("system"),3);case 3:return(d=g.yieldResult)?g.return(null):b?g.return({slot:"system",method:"kerberos"}):c?g.return({slot:"system",method:"service_account"}):g.return(null);case 2:return g.yield(ob("user"),4);case 4:return(e=g.yieldResult)?g.return(null):b?g.return({slot:"user",
method:"kerberos"}):g.return(null)}})};var Cb=function(a){this.cesRenewalUrl_=this.cepProxyUrl_="";this.isMachineCertEnrollmentAllowed_=this.isAutoEnrollmentEnabled_=!1;this.userEnrollmentTemplates_=["ChromeOSWirelessUser"];this.deviceEnrollmentTemplates_=["ChromeOSWirelessDevice"];this.userCertRequestValues_={};this.deviceCertRequestValues_={};this.placeholderValues_={Username:"Username",Password:"Password",Uri:"Enrollment URI",RequestId:"Request ID",Header:"Certificate Enrollment"};this.companyInfo_={name:"Your company name goes here.",
logo:"Your company logo goes here.",help_url:"https://support.google.com/chrome/a/answer/6324985",help_text:"Please contact your administrator for assistance."};this.logLevel_=0;this.signatureAlgo_=Bb.SHA512;this.isPendingUIEnabled_=!1;this.renewHoursBeforeExpiry_=120;this.renewReminderInterval_=24;this.requestTimeoutMilliseconds_=2E4;this.apiKey_="";this.isVerifiedAccessEnabled_=!1;this.verifiedAccessUrl_="https://verifiedaccess.googleapis.com/v1/challenge?key=";this.verifiedAccessSharedSecret_=
"";this.vaRequestTimeoutMilliseconds_=6E4;this.serviceAccountHostPasswordMask_=this.serviceAccountHost_=this.serviceAccountPassword_=this.serviceAccountName_="";this.clientAuthentication_="basic";this.isKeyBasedRenewalEnabled_=!1;this.JSC$2788_q_=a};f=Cb.prototype;f.getLoginPageLoginTabLabel=function(){return chrome.i18n.getMessage("managed_login_tab_label")};f.getLoginPageStatusTabLabel=function(){return chrome.i18n.getMessage("managed_status_tab_label")};f.getLoginPageDeviceWideCheckboxText=function(){return chrome.i18n.getMessage("managed_login_device_wide_checkbox")};
f.getLoginPageUseServiceAccountCheckboxText=function(){return chrome.i18n.getMessage("managed_login_use_service_account_checkbox")};f.getLoginPageLoginButtonText=function(){return chrome.i18n.getMessage("managed_login_button")};f.getLoginPageStatusHeaderText=function(){return chrome.i18n.getMessage("managed_status_header")};f.getLoginPageStatusButtonText=function(){return chrome.i18n.getMessage("managed_status_button")};f.getLoginPageMoreOptionsText=function(){return chrome.i18n.getMessage("managed_more_options")};
f.getLoginPageHelpLabelText=function(){return chrome.i18n.getMessage("managed_help_text")};f.getLoginPageLicenseButtonText=function(){return chrome.i18n.getMessage("managed_license_button")};f.getLoginPageClipboardButtonText=function(){return chrome.i18n.getMessage("managed_clipboard_button")};f.getCompanyName=function(){return this.companyInfo_&&this.companyInfo_.name?this.companyInfo_.name:"Your company name goes here."};
f.getCompanyLogo=function(){return this.companyInfo_&&this.companyInfo_.logo?this.companyInfo_.logo:"Your company logo goes here."};f.getHelpUrl=function(){return this.companyInfo_&&this.companyInfo_.help_url?this.companyInfo_.help_url:"https://support.google.com/chrome/a/answer/6324985"};f.getHelpText=function(){return this.companyInfo_&&this.companyInfo_.help_text?this.companyInfo_.help_text:""};
f.getLoginPageHeaderText=function(){return this.placeholderValues_&&this.placeholderValues_.Header?"managed_login_header"==this.placeholderValues_.Header?chrome.i18n.getMessage("managed_login_header"):this.placeholderValues_.Header:"Certificate Enrollment"};
f.getUsernameFormFieldPlaceholder=function(){return this.placeholderValues_&&this.placeholderValues_.Username?"managed_username_placeholder"==this.placeholderValues_.Username?chrome.i18n.getMessage("managed_username_placeholder"):this.placeholderValues_.Username:"Username"};
f.getPasswordFormFieldPlaceholder=function(){return this.placeholderValues_&&this.placeholderValues_.Password?"managed_password_placeholder"==this.placeholderValues_.Password?chrome.i18n.getMessage("managed_password_placeholder"):this.placeholderValues_.Password:"Password"};f.getUriFormFieldPlaceholder=function(){return this.placeholderValues_&&this.placeholderValues_.Uri?this.placeholderValues_.Uri:"Enrollment URI"};
f.getRequestIdFormFieldPlaceholder=function(){return this.placeholderValues_&&this.placeholderValues_.RequestId?this.placeholderValues_.RequestId:"Request ID"};f.getCepProxyUrl=function(){return this.cepProxyUrl_};f.getCesRenewalUrl=function(){return this.cesRenewalUrl_};f.isMachineCertEnrollmentAllowed=function(){return this.isMachineCertEnrollmentAllowed_};f.getUserEnrollmentTemplates=function(){return this.userEnrollmentTemplates_};f.getDeviceEnrollmentTemplates=function(){return this.deviceEnrollmentTemplates_};
f.getLogLevel=function(){return this.logLevel_};f.getSignatureAlgorithm=function(){return this.signatureAlgo_};f.isPendingUIEnabled=function(){return this.isPendingUIEnabled_};f.getHoursOffset=function(){return this.renewHoursBeforeExpiry_};f.getNotificationInterval=function(){return this.renewReminderInterval_};f.getXhrRequestTimeout=function(){return 0<this.requestTimeoutMilliseconds_?this.requestTimeoutMilliseconds_:2E4};f.getApiKey=function(){return this.apiKey_};f.isVerifiedAccessEnabled=function(){return this.isVerifiedAccessEnabled_};
f.getVerifiedAccessUrl=function(){return""!=this.verifiedAccessUrl_?this.verifiedAccessUrl_:"https://verifiedaccess.googleapis.com/v1/challenge?key="};f.getVerifiedAccessSharedSecret=function(){return this.verifiedAccessSharedSecret_};f.getVerifiedAccessRequestTimeout=function(){return 0<this.vaRequestTimeoutMilliseconds_?this.vaRequestTimeoutMilliseconds_:6E4};f.getServiceAccountName=function(){return this.serviceAccountName_};f.getServiceAccountPassword=function(){return this.serviceAccountPassword_};
f.getServiceAccountHost=function(){return this.serviceAccountHost_};f.getServiceAccountHostPasswordMask=function(){return this.serviceAccountHostPasswordMask_};f.getClientAuthentication=function(){return this.clientAuthentication_};f.getIsKeyBasedRenewalEnabled=function(){return this.isKeyBasedRenewalEnabled_};f.setCepProxyUrl_=function(a){this.cepProxyUrl_=a};f.setCesRenewalUrl_=function(a){this.cesRenewalUrl_=a};f.setAutoEnrollmentEnabled_=function(a){this.isAutoEnrollmentEnabled_=a};
f.setMachineCertEnrollmentAllowed_=function(a){this.isMachineCertEnrollmentAllowed_=a};f.setUserEnrollmentTemplates_=function(a){this.userEnrollmentTemplates_=a};f.setDeviceEnrollmentTemplates_=function(a){this.deviceEnrollmentTemplates_=a};f.setUserCertRequestValues_=function(a){this.userCertRequestValues_=a};f.getUserCertRequestValues=function(){return this.userCertRequestValues_};f.setDeviceCertRequestValues_=function(a){this.deviceCertRequestValues_=a};f.getDeviceCertRequestValues=function(){return this.deviceCertRequestValues_};
f.setPlaceholderValues_=function(a){this.placeholderValues_=a};f.setCompanyInfo_=function(a){this.companyInfo_=a};f.setLogLevel_=function(a){a=M.indexOf(a);-1!=a?this.logLevel_=a:Q(chrome.i18n.getMessage("managed_log_level_error"),N,this.getLogLevel())};f.setSignatureAlgorithm_=function(a){Bb[a]?this.signatureAlgo_=Bb[a]:Q(chrome.i18n.getMessage("managed_signature_algo_error"),N,this.getLogLevel())};f.setPendingUIEnabled_=function(a){this.isPendingUIEnabled_=a};
f.setRenewHoursBeforeExpiry_=function(a){this.renewHoursBeforeExpiry_=a};f.setRenewReminderInterval_=function(a){this.renewReminderInterval_=a};f.setXhrRequestTimeoutMilliseconds_=function(a){this.requestTimeoutMilliseconds_=1E3*a};f.setApiKey_=function(a){this.apiKey_=a};f.setVerifiedAccessEnabled_=function(a){this.isVerifiedAccessEnabled_=a};f.setVerifiedAccessUrl_=function(a){this.verifiedAccessUrl_=a};f.setVerifiedAccessSharedSecret_=function(a){this.verifiedAccessSharedSecret_=a};
f.setVaRequestTimeoutMilliseconds_=function(a){this.vaRequestTimeoutMilliseconds_=1E3*a};f.setServiceAccountName_=function(a){this.serviceAccountName_=a};f.setServiceAccountPassword_=function(a){this.serviceAccountPassword_=a};f.setServiceAccountHost_=function(a){this.serviceAccountHost_=a};f.setServiceAccountHostPasswordMask_=function(a){this.serviceAccountHostPasswordMask_=a};f.setClientAuthentication_=function(a){Object.keys(Db).includes(a)&&(this.clientAuthentication_=a)};
f.setIsKeyBasedRenewalEnabled_=function(a){this.isKeyBasedRenewalEnabled_=a};
f.populatePolicyChanges_=function(a){Q(chrome.i18n.getMessage("managed_policy_handling_info"),O,this.getLogLevel());a=JSON.parse(a);for(var b in a){var c=a[b];switch(b){case "cep_proxy_url":this.setCepProxyUrl_(c);break;case "enable_auto_enrollment":this.setAutoEnrollmentEnabled_(c);break;case "allow_machine_cert_enrollment":this.setMachineCertEnrollmentAllowed_(c);break;case "user_enrollment_templates":this.setUserEnrollmentTemplates_(c);break;case "device_enrollment_templates":this.setDeviceEnrollmentTemplates_(c);
break;case "user_cert_request_values":this.setUserCertRequestValues_(c);break;case "device_cert_request_values":this.setDeviceCertRequestValues_(c);break;case "placeholder_values":this.setPlaceholderValues_(c);break;case "company_info":this.setCompanyInfo_(c);break;case "log_level":this.setLogLevel_(c);break;case "signature_algo":this.setSignatureAlgorithm_(c);break;case "pending_ui_enabled":this.setPendingUIEnabled_(c);break;case "renew_hours_before_expiry":this.setRenewHoursBeforeExpiry_(c);break;
case "renew_reminder_interval":this.setRenewReminderInterval_(c);break;case "request_timeout_seconds":this.setXhrRequestTimeoutMilliseconds_(c);break;case "va_api_key":this.setApiKey_(c);break;case "va_enabled":this.setVerifiedAccessEnabled_(c);break;case "va_google_url":this.setVerifiedAccessUrl_(c);break;case "va_shared_secret":this.setVerifiedAccessSharedSecret_(c);break;case "va_request_timeout_seconds":this.setVaRequestTimeoutMilliseconds_(c);break;case "service_account_name":this.setServiceAccountName_(c);
break;case "service_account_password":this.setServiceAccountPassword_(c);break;case "service_account_host":this.setServiceAccountHost_(c);break;case "service_account_host_password_mask":this.setServiceAccountHostPasswordMask_(c);break;case "client_authentication":this.setClientAuthentication_(c);break;case "use_key_based_renewal":this.setIsKeyBasedRenewalEnabled_(c);break;case "ces_renewal_url":this.setCesRenewalUrl_(c)}}b=this.getCepProxyUrl();""===b?Q(chrome.i18n.getMessage("managed_cep_empty_error"),
N,this.getLogLevel()):this.isHttpsUrl_(b)||Q(chrome.i18n.getMessage("managed_cep_http_error"),N,this.getLogLevel());this.isHttpsUrl_(this.getVerifiedAccessUrl())||Q(chrome.i18n.getMessage("managed_va_url_http_error"),N,this.getLogLevel());this.isHttpsUrl_(this.getHelpUrl())||Q(chrome.i18n.getMessage("managed_company_url_http_error"),N,this.getLogLevel())};
f.requestPolicyUpdate=function(){var a=this,b=this.JSC$2788_q_.defer();Q(chrome.i18n.getMessage("managed_policy_request_info"),O,P);chrome.runtime.sendMessage({action:"policyRequest"},function(c){Q(chrome.i18n.getMessage("managed_policy_response_info"),O,P);"{}"===c||void 0===c?a.getPolicyUpdateDirectly_():a.populatePolicyChanges_(c);b.resolve()});return b.promise};
f.getPolicyUpdateDirectly_=function(){var a=this;chrome.storage.managed.get(function(b){if(0==Object.keys(b).length)Q("No managed policy found. Consumer mode.",O,P);else{Q("Managed policy found. Enterprise mode.",O,P);var c={},d;for(d in b){var e=b[d];db[d]?c[d]=e:(e=chrome.i18n.getMessage("invalid_policy_var",[d,e.toString()]),Q(e,eb,P))}b=JSON.stringify(c);a.populatePolicyChanges_(b);chrome.runtime.sendMessage({action:"policyStore",data:b},function(){})}})};
f.isHttpsUrl_=function(a){return"https://"!==a.toLowerCase().slice(0,8)?!1:8<a.length};Cb.$inject=["$q"];var Bb={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},Eb={},Db=(Eb.basic=4,Eb.kerberos=2,Eb);var S=function(a,b,c){Ba(H(a),"must provide justification");C(!/^[\s\xa0]*$/.test(H(a)),"must provide non-empty justification");return cb(b,c||null)};var Fb=function(a,b){b?a=a.replace(Na,"&amp;").replace(Oa,"&lt;").replace(Pa,"&gt;").replace(Qa,"&quot;").replace(Ra,"&#39;").replace(Sa,"&#0;"):Ta.test(a)&&(-1!=a.indexOf("&")&&(a=a.replace(Na,"&amp;")),-1!=a.indexOf("<")&&(a=a.replace(Oa,"&lt;")),-1!=a.indexOf(">")&&(a=a.replace(Pa,"&gt;")),-1!=a.indexOf('"')&&(a=a.replace(Qa,"&quot;")),-1!=a.indexOf("'")&&(a=a.replace(Ra,"&#39;")),-1!=a.indexOf("\x00")&&(a=a.replace(Sa,"&#0;")));return a};var Gb=function(a){if(a.getValues&&"function"==typeof a.getValues)return a.getValues();if("undefined"!==typeof Map&&a instanceof Map||"undefined"!==typeof Set&&a instanceof Set)return Array.from(a.values());if("string"===typeof a)return a.split("");if(wa(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}b=[];c=0;for(d in a)b[c++]=a[d];return b},Hb=function(a){if(a.getKeys&&"function"==typeof a.getKeys)return a.getKeys();if(!a.getValues||"function"!=typeof a.getValues){if("undefined"!==
typeof Map&&a instanceof Map)return Array.from(a.keys());if(!("undefined"!==typeof Set&&a instanceof Set)){if(wa(a)||"string"===typeof a){var b=[];a=a.length;for(var c=0;c<a;c++)b.push(c);return b}b=[];c=0;for(var d in a)b[c++]=d;return b}}},Ib=function(a,b,c){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,c);else if(wa(a)||"string"===typeof a)Array.prototype.forEach.call(a,b,c);else for(var d=Hb(a),e=Gb(a),g=e.length,h=0;h<g;h++)b.call(c,e[h],d&&d[h],a)};var Jb=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$"),Kb=function(a,b){if(a){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].indexOf("="),e=null;if(0<=d){var g=a[c].substring(0,d);e=a[c].substring(d+1)}else g=a[c];b(g,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}};var Lb=function(a,b){this.domain_=this.userInfo_=this.scheme_="";this.port_=null;this.fragment_=this.path_="";this.JSC$2801_ignoreCase_=this.isReadOnly_=!1;var c;a instanceof Lb?(this.JSC$2801_ignoreCase_=void 0!==b?b:a.getIgnoreCase(),this.setScheme(a.getScheme()),this.setUserInfo(a.getUserInfo()),this.setDomain(a.getDomain()),this.setPort(a.getPort()),this.setPath(a.getPath()),this.setQueryData(a.getQueryData().JSC$2806_clone()),this.setFragment(a.getFragment())):a&&(c=String(a).match(Jb))?(this.JSC$2801_ignoreCase_=
!!b,this.setScheme(c[1]||"",!0),this.setUserInfo(c[2]||"",!0),this.setDomain(c[3]||"",!0),this.setPort(c[4]),this.setPath(c[5]||"",!0),this.setQueryData(c[6]||"",!0),this.setFragment(c[7]||"",!0)):(this.JSC$2801_ignoreCase_=!!b,this.queryData_=new Mb(null,this.JSC$2801_ignoreCase_))};f=Lb.prototype;
f.toString=function(){var a=[],b=this.getScheme();b&&a.push(Nb(b,Ob,!0),":");var c=this.getDomain();if(c||"file"==b)a.push("//"),(b=this.getUserInfo())&&a.push(Nb(b,Ob,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.getPort(),null!=c&&a.push(":",String(c));if(c=this.getPath())this.hasDomain()&&"/"!=c.charAt(0)&&a.push("/"),a.push(Nb(c,"/"==c.charAt(0)?Pb:Qb,!0));(c=this.getEncodedQuery())&&a.push("?",c);(c=this.getFragment())&&a.push("#",Nb(c,Rb));return a.join("")};
f.resolve=function(a){var b=this.JSC$2804_clone(),c=a.hasScheme();c?b.setScheme(a.getScheme()):c=a.hasUserInfo();c?b.setUserInfo(a.getUserInfo()):c=a.hasDomain();c?b.setDomain(a.getDomain()):c=a.hasPort();var d=a.getPath();if(c)b.setPort(a.getPort());else if(c=a.hasPath()){if("/"!=d.charAt(0))if(this.hasDomain()&&!this.hasPath())d="/"+d;else{var e=b.getPath().lastIndexOf("/");-1!=e&&(d=b.getPath().substr(0,e+1)+d)}e=d;if(".."==e||"."==e)d="";else if(-1!=e.indexOf("./")||-1!=e.indexOf("/.")){d=0==
e.lastIndexOf("/",0);e=e.split("/");for(var g=[],h=0;h<e.length;){var l=e[h++];"."==l?d&&h==e.length&&g.push(""):".."==l?((1<g.length||1==g.length&&""!=g[0])&&g.pop(),d&&h==e.length&&g.push("")):(g.push(l),d=!0)}d=g.join("/")}else d=e}c?b.setPath(d):c=a.hasQuery();c?b.setQueryData(a.getQueryData().JSC$2806_clone()):c=a.hasFragment();c&&b.setFragment(a.getFragment());return b};f.JSC$2804_clone=function(){return new Lb(this)};f.getScheme=function(){return this.scheme_};
f.setScheme=function(a,b){this.enforceReadOnly();if(this.scheme_=b?T(a,!0):a)this.scheme_=this.scheme_.replace(/:$/,"");return this};f.hasScheme=function(){return!!this.scheme_};f.getUserInfo=function(){return this.userInfo_};f.setUserInfo=function(a,b){this.enforceReadOnly();this.userInfo_=b?T(a):a;return this};f.hasUserInfo=function(){return!!this.userInfo_};f.getDomain=function(){return this.domain_};f.setDomain=function(a,b){this.enforceReadOnly();this.domain_=b?T(a,!0):a;return this};
f.hasDomain=function(){return!!this.domain_};f.getPort=function(){return this.port_};f.setPort=function(a){this.enforceReadOnly();if(a){a=Number(a);if(isNaN(a)||0>a)throw Error("Bad port number "+a);this.port_=a}else this.port_=null;return this};f.hasPort=function(){return null!=this.port_};f.getPath=function(){return this.path_};f.setPath=function(a,b){this.enforceReadOnly();this.path_=b?T(a,!0):a;return this};f.hasPath=function(){return!!this.path_};f.hasQuery=function(){return""!==this.queryData_.toString()};
f.setQueryData=function(a,b){this.enforceReadOnly();a instanceof Mb?(this.queryData_=a,this.queryData_.JSC$2806_setIgnoreCase(this.JSC$2801_ignoreCase_)):(b||(a=Nb(a,Sb)),this.queryData_=new Mb(a,this.JSC$2801_ignoreCase_));return this};f.setQuery=function(a,b){return this.setQueryData(a,b)};f.getEncodedQuery=function(){return this.queryData_.toString()};f.getDecodedQuery=function(){return this.queryData_.toDecodedString()};f.getQueryData=function(){return this.queryData_};f.JSC$2804_getQuery=function(){return this.getEncodedQuery()};
f.setParameterValue=function(a,b){this.enforceReadOnly();this.queryData_.set(a,b);return this};f.setParameterValues=function(a,b){this.enforceReadOnly();Array.isArray(b)||(b=[String(b)]);this.queryData_.setValues(a,b);return this};f.getParameterValues=function(a){return this.queryData_.getValues(a)};f.getParameterValue=function(a){return this.queryData_.get(a)};f.getFragment=function(){return this.fragment_};f.setFragment=function(a,b){this.enforceReadOnly();this.fragment_=b?T(a):a;return this};
f.hasFragment=function(){return!!this.fragment_};f.hasSameDomainAs=function(a){return(!this.hasDomain()&&!a.hasDomain()||this.getDomain()==a.getDomain())&&(!this.hasPort()&&!a.hasPort()||this.getPort()==a.getPort())};f.makeUnique=function(){this.enforceReadOnly();this.setParameterValue("zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36));return this};
f.JSC$2804_removeParameter=function(a){this.enforceReadOnly();this.queryData_.remove(a);return this};f.setReadOnly=function(a){this.isReadOnly_=a;return this};f.isReadOnly=function(){return this.isReadOnly_};f.enforceReadOnly=function(){if(this.isReadOnly_)throw Error("Tried to modify a read-only Uri");};f.JSC$2804_setIgnoreCase=function(a){this.JSC$2801_ignoreCase_=a;this.queryData_&&this.queryData_.JSC$2806_setIgnoreCase(a);return this};f.getIgnoreCase=function(){return this.JSC$2801_ignoreCase_};
var T=function(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""},Nb=function(a,b,c){return"string"===typeof a?(a=encodeURI(a).replace(b,Tb),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null},Tb=function(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)},Ob=/[#\/\?@]/g,Qb=/[#\?:]/g,Pb=/[#\?]/g,Sb=/[#\?@]/g,Rb=/#/g,Mb=function(a,b){this.count_=this.keyMap_=null;this.encodedQuery_=a||null;this.JSC$2802_ignoreCase_=!!b};f=Mb.prototype;
f.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_=new Map,this.count_=0,this.encodedQuery_)){var a=this;Kb(this.encodedQuery_,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)})}};f.getCount=function(){this.ensureKeyMapInitialized_();return this.count_};f.add=function(a,b){this.ensureKeyMapInitialized_();this.invalidateCache_();a=this.getKeyName_(a);var c=this.keyMap_.get(a);c||this.keyMap_.set(a,c=[]);c.push(b);this.count_=F(this.count_)+1;return this};
f.remove=function(a){this.ensureKeyMapInitialized_();a=this.getKeyName_(a);return this.keyMap_.has(a)?(this.invalidateCache_(),this.count_=F(this.count_)-this.keyMap_.get(a).length,this.keyMap_.delete(a)):!1};f.clear=function(){this.invalidateCache_();this.keyMap_=null;this.count_=0};f.isEmpty=function(){this.ensureKeyMapInitialized_();return 0==this.count_};f.containsKey=function(a){this.ensureKeyMapInitialized_();a=this.getKeyName_(a);return this.keyMap_.has(a)};
f.containsValue=function(a){var b=this.getValues();return 0<=$a(b,a)};f.forEach=function(a,b){this.ensureKeyMapInitialized_();this.keyMap_.forEach(function(c,d){c.forEach(function(e){a.call(b,e,d,this)},this)},this)};f.getKeys=function(){this.ensureKeyMapInitialized_();for(var a=Array.from(this.keyMap_.values()),b=Array.from(this.keyMap_.keys()),c=[],d=0;d<b.length;d++)for(var e=a[d],g=0;g<e.length;g++)c.push(b[d]);return c};
f.getValues=function(a){this.ensureKeyMapInitialized_();var b=[];if("string"===typeof a)this.containsKey(a)&&(b=b.concat(this.keyMap_.get(this.getKeyName_(a))));else{a=Array.from(this.keyMap_.values());for(var c=0;c<a.length;c++)b=b.concat(a[c])}return b};f.set=function(a,b){this.ensureKeyMapInitialized_();this.invalidateCache_();a=this.getKeyName_(a);this.containsKey(a)&&(this.count_=F(this.count_)-this.keyMap_.get(a).length);this.keyMap_.set(a,[b]);this.count_=F(this.count_)+1;return this};
f.get=function(a,b){if(!a)return b;a=this.getValues(a);return 0<a.length?String(a[0]):b};f.setValues=function(a,b){this.remove(a);if(0<b.length){this.invalidateCache_();var c=this.keyMap_,d=c.set;a=this.getKeyName_(a);var e=b.length;if(0<e){for(var g=Array(e),h=0;h<e;h++)g[h]=b[h];e=g}else e=[];d.call(c,a,e);this.count_=F(this.count_)+b.length}};
f.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";for(var a=[],b=Array.from(this.keyMap_.keys()),c=0;c<b.length;c++){var d=b[c],e=encodeURIComponent(String(d));d=this.getValues(d);for(var g=0;g<d.length;g++){var h=e;""!==d[g]&&(h+="="+encodeURIComponent(String(d[g])));a.push(h)}}return this.encodedQuery_=a.join("&")};f.toDecodedString=function(){return T(this.toString())};f.invalidateCache_=function(){this.encodedQuery_=null};
f.filterKeys=function(a){this.ensureKeyMapInitialized_();this.keyMap_.forEach(function(b,c){0<=$a(a,c)||this.remove(c)},this);return this};f.JSC$2806_clone=function(){var a=new Mb;a.encodedQuery_=this.encodedQuery_;this.keyMap_&&(a.keyMap_=new Map(this.keyMap_),a.count_=this.count_);return a};f.getKeyName_=function(a){a=String(a);this.JSC$2802_ignoreCase_&&(a=a.toLowerCase());return a};
f.JSC$2806_setIgnoreCase=function(a){a&&!this.JSC$2802_ignoreCase_&&(this.ensureKeyMapInitialized_(),this.invalidateCache_(),this.keyMap_.forEach(function(b,c){var d=c.toLowerCase();c!=d&&(this.remove(c),this.setValues(d,b))},this));this.JSC$2802_ignoreCase_=a};f.extend=function(a){for(var b=0;b<arguments.length;b++)Ib(arguments[b],function(c,d){this.add(d,c)},this)};var U=function(a,b,c,d,e,g,h){var l=this;this.isRequestingNewCertificate_=!0;this.useServiceAccountCheckboxText=this.deviceWideCheckboxText=this.h2Text=this.enrollOrCheckStatusButtonText=this.showOrHidePendingRequestText="";this.showDeviceWideCheckbox=!0;this.showServiceAccountCheckbox=!1;this.maskedPassword=this.passwordMask=this.passwordValueToBeMasked=this.passwordValue=this.usernameValue=this.passwordFormFieldPlaceholder=this.usernameFormFieldPlaceholder="";this.isUserRequestingDeviceWideCertValue=
!1;this.checkStatusButtonText_=this.requestIdValue=this.requestIdFormFieldPlaceholder=this.uriValue=this.uriFormFieldPlaceholder=this.loginButtonText_="";this.invalidCharacterText=chrome.i18n.getMessage("login_invalid_character");this.passwordMaskToolName=this.helpLabelText=this.helpText=this.helpUrl=this.moreOptionsValue=this.moreOptionsText="";this.pendingUIEnabled=!0;this.copyToClipboardButtonText=this.licenseNoticeButtonText="";this.showPendingRequestText_=chrome.i18n.getMessage("login_show_pending");
this.hidePendingRequestText_=chrome.i18n.getMessage("login_hide_pending");this.privacyLinkText=chrome.i18n.getMessage("login_privacy_link");this.helpCenterText=chrome.i18n.getMessage("login_help_center_text");this.deviceWideHelpText=chrome.i18n.getMessage("login_device_help");this.useServiceAccountHelpText=chrome.i18n.getMessage("login_service_account_help");this.loadingText=chrome.i18n.getMessage("login_loading_text");this.companyLogo=this.companyName=this.kerberosAuthenticationText="";this.clientAuthentication=
"basic";this.managedPolicyService_=a;this.tokenService_=b;this.certificatePolicyService_=c;this.certificateSavingService_=d;this.enrollmentAgentService_=e;this.mdDialog_=g;this.scope_=h;this.useServiceAccount=!1;this.DUMMY_SERVICE_ACCOUNT_PASSWORD_="dummy-password";this.HOSTED_SERVICE_ACCOUNT_USERNAME_PLACEHOLDER_="...";this.managedPolicyService_.requestPolicyUpdate().then(function(){return v(function(k){l.setFormValuesFromManagedPolicy_();l.checkAutoEnrollmentQueryParameters_();k.jumpToEnd()})},
function(){})};f=U.prototype;
f.checkAutoEnrollmentQueryParameters_=function(){var a=this,b,c;return v(function(d){switch(d.nextAddress){case 1:b=(new Lb(window.location.href)).getQueryData();c=b.get("autoEnrollmentType");switch(c){case "auto_provision":return d.jumpTo(2);case "renewal":return d.jumpTo(3);default:Q("Query parameter unknown.",N,a.managedPolicyService_.getLogLevel())}d.jumpTo(0);break;case 2:return d.yield(a.autoEnrollCertificate_(),5);case 5:d.jumpTo(0);break;case 3:return d.yield(a.doAutoRenewal_(),6);case 6:d.jumpTo(0)}})};
f.doAutoRenewal_=function(){var a=this,b,c;return v(function(d){switch(d.nextAddress){case 1:return Q("Auto-renewal requested.",P,a.managedPolicyService_.getLogLevel()),d.yield(pb(a.managedPolicyService_.isMachineCertEnrollmentAllowed()),2);case 2:b=d.yieldResult;if(!b)return Q("No certificate found for auto renewal.",P,a.managedPolicyService_.getLogLevel()),d.return();Q("Certificate found for auto renewal.",P,a.managedPolicyService_.getLogLevel());c="system"===b.slot;if(!a.managedPolicyService_.getIsKeyBasedRenewalEnabled()){d.jumpTo(3);
break}return d.yield(a.tokenService_.setTokenFromPlatformKeys(c),4);case 4:return a.doKeyBasedRenewal_(b.cert),d.return();case 3:if(a.useKerberosAuth_())return a.autoEnrollWithKerberos_(c),d.return();if(!c)return Q("Renewal of user certificates is not enabled.",N,a.managedPolicyService_.getLogLevel()),d.return();if(!a.isServiceAccountConfigured_()){d.jumpTo(0);break}return d.yield(a.tokenService_.setTokenFromPlatformKeys(c),6);case 6:a.autoEnrollWithServiceAccount_(),d.jumpToEnd()}})};
f.isServiceAccountConfigured_=function(){return this.managedPolicyService_.getServiceAccountName()&&""!=this.managedPolicyService_.getServiceAccountName()||this.managedPolicyService_.getServiceAccountHost()&&""!=this.managedPolicyService_.getServiceAccountHost()?!0:!1};f.useKerberosAuth_=function(){return"kerberos"===this.clientAuthentication};
f.doKeyBasedRenewal_=function(a){var b=this;return v(function(c){if(1==c.nextAddress)return Q("Sending key-based renewal request to CES: "+b.managedPolicyService_.getCesRenewalUrl()+".",P,b.managedPolicyService_.getLogLevel()),b.startProgress_(0),c.setCatchFinallyBlocks(2),c.yield(b.certificateSavingService_.renewCertificate(b.managedPolicyService_.getCesRenewalUrl(),a),4);if(2!=c.nextAddress)return b.notify_(chrome.i18n.getMessage("success_title"),chrome.i18n.getMessage("certificate_renewal_alert"),
!0),c.leaveTryBlock(0);c.enterCatchBlock();b.notify_(chrome.i18n.getMessage("failure_title"),chrome.i18n.getMessage("certificate_renewal_failure_alert"),!0);c.jumpToEnd()})};
f.autoEnrollCertificate_=function(){var a=this,b,c;return v(function(d){if(1==d.nextAddress)return d.setCatchFinallyBlocks(2),d.yield(Ab(a.managedPolicyService_.isMachineCertEnrollmentAllowed(),a.useKerberosAuth_(),a.isServiceAccountConfigured_()),4);if(2!=d.nextAddress){b=d.yieldResult;if(!b)return Q("Failure to auto-provision certificate: either a valid certificate already exists on the device or auto-provisioning is not supported by policy.",P,a.managedPolicyService_.getLogLevel()),d.return();
switch(b.method){case "kerberos":a.autoEnrollWithKerberos_("system"===b.slot);break;case "service_account":a.autoEnrollWithServiceAccount_();break;default:Q("Unknown provisioning method.",N,a.managedPolicyService_.getLogLevel())}return d.leaveTryBlock(0)}c=d.enterCatchBlock();Q(c.message,N,a.managedPolicyService_.getLogLevel());d.jumpToEnd()})};
f.autoEnrollWithServiceAccount_=function(){Q("Auto-triggering enrollment of a device wide\n        certificate using the provided service account.",O,this.managedPolicyService_.getLogLevel());var a=this.managedPolicyService_.getDeviceEnrollmentTemplates(),b=this.managedPolicyService_.isMachineCertEnrollmentAllowed();this.isServiceAccountConfigured_()&&a&&b&&(this.useServiceAccount=!0,this.handleUseServiceAccountChange(),this.decideEnrollmentRequest())};
f.autoEnrollWithKerberos_=function(a){var b=this;this.isUserRequestingDeviceWideCertValue=a;Q(a?"Auto-triggering enrollment of a device wide certificate using Kerberos.":"Auto-triggering enrollment of a user certificate using Kerberos.",O,this.managedPolicyService_.getLogLevel());this.startProgress_(0);setTimeout(function(){b.submitForm_()},1E4)};
f.handleUseServiceAccountChange=function(){var a=this;this.useServiceAccount?(this.managedPolicyService_.getServiceAccountHost()?(this.usernameValue=this.HOSTED_SERVICE_ACCOUNT_USERNAME_PLACEHOLDER_,this.getEnrollmentCredentials_().then(function(b){a.usernameValue=b.username;a.scope_.$apply()},function(){})):this.usernameValue=this.managedPolicyService_.getServiceAccountName(),this.passwordValue=this.DUMMY_SERVICE_ACCOUNT_PASSWORD_):this.passwordValue=this.usernameValue=""};
f.handleRequestingDeviceWideCertChange=function(){this.useServiceAccount=this.isUserRequestingDeviceWideCertValue&&this.isServiceAccountConfigured_()?this.showServiceAccountCheckbox=!0:this.showServiceAccountCheckbox=!1};
f.getEnrollmentCredentials_=function(){var a=this,b,c,d,e,g;return v(function(h){switch(h.nextAddress){case 1:if(!a.useServiceAccount||!a.managedPolicyService_.getServiceAccountHost()){h.jumpTo(2);break}return h.yield(fetch(a.managedPolicyService_.getServiceAccountHost(),{method:"GET",cache:"no-cache"}),3);case 3:return b=h.yieldResult,Q("HostedServiceAccount: Got status: ${response.status}",N,a.managedPolicyService_.getLogLevel()),b.ok?h.yield(b.json(),4):h.return(Promise.reject("Failed to get hosted credentials."));
case 4:c=h.yieldResult;if(!c.hasOwnProperty("username")||!c.hasOwnProperty("maskedPassword"))return Q("HostedServiceAccount: Missing fields",N,a.managedPolicyService_.getLogLevel()),h.return(Promise.reject("Missing fields"));d=c.username;e=c.maskedPassword;Q("ServiceAccountHost: Unmasking",O,a.managedPolicyService_.getLogLevel());return h.yield(zb({masked:e,mask:a.managedPolicyService_.getServiceAccountHostPasswordMask()}),5);case 5:return g=h.yieldResult,h.return({username:d,password:g});case 2:return a.useServiceAccount&&
a.managedPolicyService_.getServiceAccountName()?h.return({username:a.managedPolicyService_.getServiceAccountName(),password:a.managedPolicyService_.getServiceAccountPassword()}):h.return({username:a.usernameValue,password:a.passwordValue})}})};f.getDeviceWideValue_=function(){return this.useServiceAccount?!0:this.isUserRequestingDeviceWideCertValue};
f.failureAlert_=function(a){Q(a,N,this.managedPolicyService_.getLogLevel());this.notify_(chrome.i18n.getMessage("failure_title"),chrome.i18n.getMessage("login_failure_alert"),!0)};f.pendingAlert_=function(a,b,c){Q(a,O,this.managedPolicyService_.getLogLevel());""===this.requestIdValue&&""===this.uriValue&&(this.requestIdValue=b,this.uriValue=c);this.notify_(chrome.i18n.getMessage("pending_title"),a,!0)};
f.notify_=function(a,b,c){var d=chrome.i18n.getMessage("okay_button");a=this.mdDialog_.alert().title(a).htmlContent(b).ok(d);c&&this.hideProgress_();this.mdDialog_.show(a)};f.resetOnEscape=function(){-1==document.getElementById("moreOptionsMenu").className.indexOf("md-open")&&this.removeNegativeTabIndexes()};f.setNegativeTabIndexes=function(){this.setTabIndexes_("-1")};f.removeNegativeTabIndexes=function(){this.setTabIndexes_("")};
f.setTabIndexes_=function(a){for(var b=document.getElementsByClassName("elementToHideWhenMenuIsOpen"),c=0;c<b.length;c++)b[c].setAttribute("tabindex",a);document.getElementById("checkboxToHideWhenMenuIsOpen").setAttribute("tabindex","-1"===a?"-1":"0")};f.startProgress_=function(a){document.getElementsByClassName("hiddenProgressCircular")[a].style.visibility="visible"};
f.hideProgress_=function(){for(var a=document.getElementsByClassName("hiddenProgressCircular"),b=0;b<a.length;b++)a[b].style.visibility="hidden"};f.showLicense=function(){this.mdDialog_.show({controller:"ccr.controllers.LoginPageCtrl",templateUrl:La(H(I("../html/notice.html"))),clickOutsideToClose:!0})};f.copyToClipboard=function(){var a=document.createElement("input");a.style.position="fixed";a.style.zIndex="-1";a.value=fb;document.body.appendChild(a);a.select();document.execCommand("copy");document.body.removeChild(a)};
f.showHelpText=function(){var a=La(H(I("../html/help_text_anchor.html")));""===this.helpText&&(a=La(H(I("../html/help_anchor.html"))));this.mdDialog_.show({controller:"ccr.controllers.LoginPageCtrl",templateUrl:a,clickOutsideToClose:!0,parent:angular.element(document.body)})};
f.showPasswordMaskTool=function(){this.passwordMask=this.maskedPassword=this.passwordValueToBeMasked="";this.mdDialog_.show({controller:"ccr.controllers.LoginPageCtrl",templateUrl:La(H(I("../html/password_mask_tool.html"))),clickOutsideToClose:!0,parent:angular.element(document.body)})};f.generateMaskedPassword=function(){var a=this,b;return v(function(c){if(1==c.nextAddress)return c.yield(yb(a.passwordValueToBeMasked),2);b=c.yieldResult;a.maskedPassword=b.masked;a.passwordMask=b.mask;c.jumpToEnd()})};
f.setFormValuesFromManagedPolicy_=function(){this.h2Text=this.managedPolicyService_.getLoginPageHeaderText();this.deviceWideCheckboxText=this.managedPolicyService_.getLoginPageDeviceWideCheckboxText();this.showDeviceWideCheckbox=this.managedPolicyService_.isMachineCertEnrollmentAllowed();this.useServiceAccountCheckboxText=this.managedPolicyService_.getLoginPageUseServiceAccountCheckboxText();this.usernameFormFieldPlaceholder=this.managedPolicyService_.getUsernameFormFieldPlaceholder();this.passwordFormFieldPlaceholder=
this.managedPolicyService_.getPasswordFormFieldPlaceholder();this.loginButtonText_=this.managedPolicyService_.getLoginPageLoginButtonText();this.uriFormFieldPlaceholder=this.managedPolicyService_.getUriFormFieldPlaceholder();this.requestIdFormFieldPlaceholder=this.managedPolicyService_.getRequestIdFormFieldPlaceholder();this.checkStatusButtonText_=this.managedPolicyService_.getLoginPageStatusButtonText();this.moreOptionsText=this.managedPolicyService_.getLoginPageMoreOptionsText();this.helpUrl=this.managedPolicyService_.getHelpUrl();
this.helpText=this.managedPolicyService_.getHelpText();this.helpLabelText=this.managedPolicyService_.getLoginPageHelpLabelText();this.licenseNoticeButtonText=this.managedPolicyService_.getLoginPageLicenseButtonText();this.copyToClipboardButtonText=this.managedPolicyService_.getLoginPageClipboardButtonText();this.passwordMaskToolName="Password mask tool";this.companyName=this.managedPolicyService_.getCompanyName();this.companyLogo=this.managedPolicyService_.getCompanyLogo();this.pendingUIEnabled=this.managedPolicyService_.isPendingUIEnabled();
this.showOrHidePendingRequestText=this.showPendingRequestText_;this.enrollOrCheckStatusButtonText=this.loginButtonText_;this.kerberosAuthenticationText=chrome.i18n.getMessage("kerberos_authentication_text",this.enrollOrCheckStatusButtonText);this.clientAuthentication=this.managedPolicyService_.getClientAuthentication();var a=this.managedPolicyService_.getDeviceEnrollmentTemplates(),b=this.managedPolicyService_.isMachineCertEnrollmentAllowed();this.isServiceAccountConfigured_()&&a&&b&&(this.isUserRequestingDeviceWideCertValue=
this.useServiceAccount=this.showServiceAccountCheckbox=!0,this.handleUseServiceAccountChange(),this.handleRequestingDeviceWideCertChange())};
f.flipBetweenSubmitAndCheck=function(){if(this.isRequestingNewCertificate_){document.getElementById("extraFieldsForCheckStatus").className="showExtraFieldsForCheckStatus";var a=document.getElementById("mainCard");a.className=a.className.replace("smallMainCard","bigMainCard").trim();a=document.getElementsByClassName("inputsRequiredForPendingRequest");for(var b=0;b<a.length;b++)a[b].setAttribute("required","");this.showOrHidePendingRequestText=this.hidePendingRequestText_;this.enrollOrCheckStatusButtonText=
this.checkStatusButtonText_;this.isRequestingNewCertificate_=!1}else{document.getElementById("extraFieldsForCheckStatus").className="hideExtraFieldsForCheckStatus";a=document.getElementById("mainCard");a.className=a.className.replace("bigMainCard","smallMainCard").trim();a=document.getElementsByClassName("inputsRequiredForPendingRequest");for(b=0;b<a.length;b++)a[b].removeAttribute("required");this.showOrHidePendingRequestText=this.showPendingRequestText_;this.enrollOrCheckStatusButtonText=this.loginButtonText_;
this.isRequestingNewCertificate_=!0}};f.decideEnrollmentRequest=function(){this.managedPolicyService_.isVerifiedAccessEnabled()?this.submitVaForm_():this.isRequestingNewCertificate_?this.submitForm_():this.queryStatus_()};
f.submitVaForm_=function(){var a=this,b,c,d,e,g,h,l,k,m;return v(function(n){switch(n.nextAddress){case 1:return Q("Submit button triggered with va.",O,a.managedPolicyService_.getLogLevel()),b=!a.useKerberosAuth_(),n.setCatchFinallyBlocks(2),n.yield(a.getEnrollmentCredentials_(),4);case 4:c=n.yieldResult;n.leaveTryBlock(3);break;case 2:return d=n.enterCatchBlock(),a.failureAlert_(d.message),n.return();case 3:e=b?c.username:null;g=b?c.password:null;h=a.getDeviceWideValue_();if(""===e&&b)return a.notify_(chrome.i18n.getMessage("failure_title"),
chrome.i18n.getMessage("empty_username"),!0),n.return();l="";k=a.managedPolicyService_.getCepProxyUrl();m=a.managedPolicyService_.getUserEnrollmentTemplates();a.startProgress_(0);a.tokenService_.setTokenFromPlatformKeys(h).then(function(){void 0===a.tokenService_.getCurrentToken()?(l=a.tokenService_.JSC$2913_getErrorMessage(),a.notify_(chrome.i18n.getMessage("failure_title"),l,!0)):a.enrollToGivenEndpoint_(a.enrollmentAgentService_,k,m,e,g)},function(){l=a.tokenService_.JSC$2913_getErrorMessage();
a.notify_(chrome.i18n.getMessage("failure_title"),l,!0)});n.jumpToEnd()}})};
f.submitForm_=function(){var a=this,b,c,d,e,g,h,l;return v(function(k){switch(k.nextAddress){case 1:return Q("Submit button triggered.",O,a.managedPolicyService_.getLogLevel()),b=!a.useKerberosAuth_(),k.setCatchFinallyBlocks(2),k.yield(a.getEnrollmentCredentials_(),4);case 4:c=k.yieldResult;k.leaveTryBlock(3);break;case 2:return d=k.enterCatchBlock(),a.failureAlert_(d.message),k.return();case 3:e=b?c.username:null;g=b?c.password:null;h=a.getDeviceWideValue_();if(!e&&b)return a.notify_(chrome.i18n.getMessage("failure_title"),
chrome.i18n.getMessage("empty_username"),!0),k.return();l="";a.startProgress_(0);a.tokenService_.setTokenFromPlatformKeys(h).then(function(){void 0===a.tokenService_.getCurrentToken()?(l=a.tokenService_.JSC$2913_getErrorMessage(),a.notify_(chrome.i18n.getMessage("failure_title"),l,!0)):a.certificatePolicyService_.contactPolicyServer(e,g).then(function(){var m=a.certificatePolicyService_.getAllEnrollmentUris();0<m.length?a.enrollToEachEndpointTuple_(m,e,g):(l=chrome.i18n.getMessage("login_no_uri_failure"),
a.failureAlert_(l))},function(){a.certificatePolicyService_.isSpecificErrorPresent()?a.notify_(chrome.i18n.getMessage("failure_title"),a.certificatePolicyService_.JSC$2832_getErrorMessage(),!0):a.failureAlert_(chrome.i18n.getMessage("login_cep_failure"))})},function(){l=a.tokenService_.JSC$2913_getErrorMessage();a.notify_(chrome.i18n.getMessage("failure_title"),l,!0)});k.jumpToEnd()}})};
f.enrollToEachEndpointTuple_=function(a,b,c){a=a.shift();this.enrollToGivenEndpoint_(this.certificateSavingService_,a.uri,[a.name],b,c)};
f.enrollToGivenEndpoint_=function(a,b,c,d,e){var g=this,h="";a.enroll(b,d,e,c).then(function(){a.isEnrolledSuccessfully()?g.notify_(chrome.i18n.getMessage("success_title"),chrome.i18n.getMessage("login_success_alert"),!0):a.isRequestPending()?(h=a.JSC$2832_getErrorMessage(),g.pendingAlert_(h,a.getPendingRequestId(),a.getPendingRequestUri())):(h=a.JSC$2832_getErrorMessage(),g.failureAlert_(h))},function(){a.isSpecificErrorPresent()?g.notify_(chrome.i18n.getMessage("failure_title"),a.JSC$2832_getErrorMessage(),
!0):g.failureAlert_(chrome.i18n.getMessage("login_enrollment_failure"))})};
f.queryStatus_=function(){var a=this,b,c,d,e,g,h,l,k,m;return v(function(n){switch(n.nextAddress){case 1:Q("Query status button triggered.",O,a.managedPolicyService_.getLogLevel());if(null==a.uriValue||void 0==a.uriValue||!a.uriValue.startsWith("https://"))return a.notify_(chrome.i18n.getMessage("failure_title"),chrome.i18n.getMessage("login_query_uri"),!0),n.return();b=!a.useKerberosAuth_();n.setCatchFinallyBlocks(2);return n.yield(a.getEnrollmentCredentials_(),4);case 4:c=n.yieldResult;n.leaveTryBlock(3);
break;case 2:return d=n.enterCatchBlock(),a.failureAlert_(d.message),n.return();case 3:e=b?c.username:null,g=b?c.password:null,h=a.getDeviceWideValue_(),l=Fb(a.uriValue),k=Fb(a.requestIdValue),m="",a.startProgress_(1),a.tokenService_.setTokenFromPlatformKeys(h).then(function(){void 0===a.tokenService_.getCurrentToken()?(m=a.tokenService_.JSC$2913_getErrorMessage(),a.notify_(chrome.i18n.getMessage("failure_title"),m,!0)):a.certificateSavingService_.checkPendingRequestStatus(l,k,e,g).then(function(){a.certificateSavingService_.isEnrolledSuccessfully()?
a.notify_(chrome.i18n.getMessage("success_title"),chrome.i18n.getMessage("login_success_alert"),!0):a.certificateSavingService_.isRequestPending()?(m=a.certificateSavingService_.JSC$2832_getErrorMessage(),a.pendingAlert_(m,a.certificateSavingService_.getPendingRequestId(),a.certificateSavingService_.getPendingRequestUri())):(m=a.certificateSavingService_.JSC$2832_getErrorMessage(),a.failureAlert_(m))},function(){a.certificateSavingService_.isSpecificErrorPresent()?a.notify_(chrome.i18n.getMessage("failure_title"),
a.certificateSavingService_.JSC$2832_getErrorMessage(),!0):a.failureAlert_(chrome.i18n.getMessage("login_enrollment_failure"))})},function(){m=a.tokenService_.JSC$2913_getErrorMessage();a.notify_(chrome.i18n.getMessage("failure_title"),m,!0)}),n.jumpToEnd()}})};z("ccr.controllers.LoginPageCtrl",U,!0,void 0);U.prototype.decideEnrollmentRequest=U.prototype.decideEnrollmentRequest;U.prototype.flipBetweenSubmitAndCheck=U.prototype.flipBetweenSubmitAndCheck;U.prototype.generateMaskedPassword=U.prototype.generateMaskedPassword;
U.prototype.showPasswordMaskTool=U.prototype.showPasswordMaskTool;U.prototype.showHelpText=U.prototype.showHelpText;U.prototype.copyToClipboard=U.prototype.copyToClipboard;U.prototype.showLicense=U.prototype.showLicense;U.prototype.removeNegativeTabIndexes=U.prototype.removeNegativeTabIndexes;U.prototype.setNegativeTabIndexes=U.prototype.setNegativeTabIndexes;U.prototype.resetOnEscape=U.prototype.resetOnEscape;U.prototype.handleRequestingDeviceWideCertChange=U.prototype.handleRequestingDeviceWideCertChange;
U.prototype.handleUseServiceAccountChange=U.prototype.handleUseServiceAccountChange;U.$inject="managedPolicyService tokenService certificatePolicyService certificateSavingService enrollmentAgentService $mdDialog $scope".split(" ");var Ub=function(a,b){this.JSC$2826_managedPolicy_=a;this.JSC$2826_q_=b;this.replacements={}};f=Ub.prototype;f.doReplacementsOnSubject_=function(a){for(var b={},c=u(Vb),d=c.next();!d.done;d=c.next())d=d.value,d in a&&a[d]&&(b[d]=tb(a[d],this.replacements));return b};f.doReplacementsOnSubjectAlternativeNames_=function(a){var b=[];a=u(a);for(var c=a.next();!c.done;c=a.next()){var d=c.value;"NameType"in d&&"Name"in d&&(c=d.NameType,d=tb(d.Name,this.replacements),b.push({NameType:c,Name:d}))}return b};
f.populateReplacements_=function(){var a=this,b=[],c=[];if(chrome&&chrome.enterprise&&chrome.enterprise.deviceAttributes){if(chrome.enterprise.deviceAttributes.getDirectoryDeviceId){c.push("enterprise.deviceAttributes.getDirectoryDeviceId");var d=this.JSC$2826_q_.defer();b.push(d.promise);chrome.enterprise.deviceAttributes.getDirectoryDeviceId(function(k){a.replacements.DEVICE_DIRECTORY_ID=k;d.resolve()})}if(chrome.enterprise.deviceAttributes.getDeviceAssetId){c.push("enterprise.deviceAttributes.getDeviceAssetId");
var e=this.JSC$2826_q_.defer();b.push(e.promise);chrome.enterprise.deviceAttributes.getDeviceAssetId(function(k){a.replacements.DEVICE_ASSET_ID=k;e.resolve()})}if(chrome.enterprise.deviceAttributes.getDeviceAnnotatedLocation){c.push("enterprise.deviceAttributes.getDeviceAnnotatedLocation");var g=this.JSC$2826_q_.defer();b.push(g.promise);chrome.enterprise.deviceAttributes.getDeviceAnnotatedLocation(function(k){a.replacements.DEVICE_ANNOTATED_LOCATION=k;g.resolve()})}if(chrome.enterprise.deviceAttributes.getDeviceSerialNumber){c.push("enterprise.deviceAttributes.getDeviceSerialNumber");
var h=this.JSC$2826_q_.defer();b.push(h.promise);chrome.enterprise.deviceAttributes.getDeviceSerialNumber(function(k){a.replacements.DEVICE_SERIAL_NUMBER=k;h.resolve()})}}if(chrome&&chrome.identity&&chrome.identity.getProfileUserInfo){c.push("chrome.identity.getProfileUserInfo");var l=this.JSC$2826_q_.defer();b.push(l.promise);chrome.identity.getProfileUserInfo(function(k){k=k.email;a.replacements.USER_EMAIL=k;var m="",n="",q=k.lastIndexOf("@");-1!=q&&(m=k.substring(0,q),n=k.substring(q+1));a.replacements.USER_ID=
m;a.replacements.USER_DOMAIN=n;l.resolve()})}Q("Found the following APIs: "+c.join(),P,this.JSC$2826_managedPolicy_.getLogLevel());return this.JSC$2826_q_.all(b)};f.logAvailableReplacements_=function(){for(var a=[],b=u(Object.keys(this.replacements)),c=b.next();!c.done;c=b.next())c=c.value,this.replacements[c]?a.push(c):a.push(c+" (no value)");Q("Available placeholders: "+a.join(),P,this.JSC$2826_managedPolicy_.getLogLevel())};
f.getCertRequestValues=function(a){var b=this,c=this.JSC$2826_q_.defer();this.populateReplacements_().then(function(){var d=a?b.JSC$2826_managedPolicy_.getDeviceCertRequestValues():b.JSC$2826_managedPolicy_.getUserCertRequestValues(),e={};b.logAvailableReplacements_();"Subject"in d&&(e.Subject=b.doReplacementsOnSubject_(d.Subject));"SubjectAlternativeNames"in d&&d.SubjectAlternativeNames instanceof Array&&(e.SubjectAlternativeNames=b.doReplacementsOnSubjectAlternativeNames_(d.SubjectAlternativeNames));
c.resolve(e)});return c.promise};Ub.$inject=["managedPolicyService","$q"];var Vb="CommonName Country DeviceSerialNumber Locality Organization OrganizationUnit State".split(" ");var V=function(a,b,c){this.managedPolicy=a;this.tokenService=b;this.JSC$2830_q=c;this.hasSpecificError=!1;this.JSC$2830_errorMessage=""};V.prototype.isSpecificErrorPresent=function(){return this.hasSpecificError};V.prototype.JSC$2832_getErrorMessage=function(){return this.JSC$2830_errorMessage};V.$inject=["managedPolicyService","tokenService","$q"];/*

 SPDX-License-Identifier: Apache-2.0
*/
function W(a,b,c){return a.parseFromString(bb(b),c)};var Wb=function(a,b,c){V.call(this,a,b,c);this.enrollmentUris_=[]};la(Wb,V);f=Wb.prototype;
f.contactPolicyServer=function(a,b){var c=this,d=this.JSC$2830_q.defer(),e=this.managedPolicy.getCepProxyUrl();Q("Contacting CEP server at: "+e,P,this.managedPolicy.getLogLevel());var g=new XMLHttpRequest;g.open("POST",e,!0,a,b);g.withCredentials=!0;g.setRequestHeader("Content-type","application/soap+xml; charset=utf-8");var h=new DOMParser,l=W(h,S(I("String literal."),Xb),"application/xml");l.getElementById("ccr-cep-proxy-url").textContent=e;"basic"===this.managedPolicy.getClientAuthentication()&&
(e=W(h,S(I("String literal."),Yb),"application/xml"),e.getElementById("ccr-basic-auth-username").textContent=a,e.getElementById("ccr-basic-auth-password").textContent=b,l.getElementById("ccr-header").appendChild(e.firstElementChild));ub(l);a=(new XMLSerializer).serializeToString(l);g.onreadystatechange=function(){4==g.readyState&&(200==g.status?(c.cepSuccessCallback_(g.responseText),d.resolve()):(c.cepFailureCallback_(g.responseText,g.statusText),d.reject()))};g.timeout=this.managedPolicy.getXhrRequestTimeout();
g.ontimeout=function(){g.abort();c.hasSpecificError=!0;c.JSC$2830_errorMessage=chrome.i18n.getMessage("policy_timeout_error");Q(c.JSC$2830_errorMessage,N,c.managedPolicy.getLogLevel());d.reject()};g.send(a);return d.promise};
f.cepSuccessCallback_=function(a){var b=new DOMParser;a=W(b,cb(a,null),"text/xml").getElementsByTagName("GetPoliciesResponse")[0].children;var c,d;for(b=0;b<a.length;b++)a[b].tagName==X.RESPONSE?c=a[b]:a[b].tagName==X.CAS&&(d=a[b]);this.enrollmentUris_=[];c&&d&&(c=this.mapAndFilterTemplateNamesAndCaRefs_(c),this.enrollmentUris_=this.getAvailableEndpointsFromCaTag_(d,c))};
f.mapAndFilterTemplateNamesAndCaRefs_=function(a){var b=this.tokenService.getMatchingTemplates(),c=a.getElementsByTagName(X.POLICY);a={};for(var d=0;d<c.length;d++){var e=c[d];a[e.getElementsByTagName(X.COMMON_NAME)[0].innerHTML]=e.getElementsByTagName(X.CA_REFERENCE)[0].innerHTML}c=[];for(d=0;d<b.length;d++)if(e=b[d],a[e]){var g={name:e};g.ca=a[e];c.push(g)}return c};
f.getAvailableEndpointsFromCaTag_=function(a,b){var c=[];a=a.getElementsByTagName(X.CA_REFERENCE_ID);for(var d=0;d<b.length;d++)for(var e=b[d].ca,g=0;g<a.length;g++)if(a[g].innerHTML===e)for(var h=a[g].parentElement.getElementsByTagName(X.CAURI),l=0;l<h.length;l++){var k=h[l],m=k.getElementsByTagName(X.CLIENT_AUTHENTICATION);m=m[m.length-1];var n=Db[this.managedPolicy.getClientAuthentication()];m&&m.innerHTML===n.toString()&&(m=k.getElementsByTagName(X.RENEWAL_ONLY),m=m[m.length-1],!m||"false"==m.innerHTML)&&
(k=k.getElementsByTagName(X.URI),k=k[k.length-1])&&(k=k.innerHTML,m={},m.name=b[d].name,m.uri=k,c.push(m))}return c};f.cepFailureCallback_=function(a,b){var c=new DOMParser;a=W(c,cb(a,null),"text/xml");"FailedAuthentication"===ib(a,"Value").slice(-20)?(this.hasSpecificError=!0,this.JSC$2830_errorMessage=chrome.i18n.getMessage("invalid_credentials")):(this.hasSpecificError=!1,this.JSC$2830_errorMessage=chrome.i18n.getMessage("policy_bad_response",b));Q(this.JSC$2830_errorMessage,N,this.managedPolicy.getLogLevel())};
f.getAllEnrollmentUris=function(){return this.enrollmentUris_};Wb.prototype.contactPolicyServer.$inject=["user","pass"];Wb.$inject=["managedPolicyService","tokenService","$q"];
var X={RESPONSE:"response",CAS:"cAs",POLICY:"policy",CA_REFERENCE:"cAReference",COMMON_NAME:"commonName",CA_REFERENCE_ID:"cAReferenceID",CAURI:"cAURI",CLIENT_AUTHENTICATION:"clientAuthentication",RENEWAL_ONLY:"renewalOnly",URI:"uri"},Xb=R('\n<s:Envelope\n    xmlns:s="http://www.w3.org/2003/05/soap-envelope"\n    xmlns:a="http://www.w3.org/2005/08/addressing"\n    xmlns:u="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">\n  <s:Header id="ccr-header">\n    <a:Action s:mustUnderstand="1">\n      http://schemas.microsoft.com/windows/pki/2009/01/enrollmentpolicy/IPolicy/GetPolicies\n    </a:Action>\n    <a:ReplyTo>\n      <a:Address>\n        http://www.w3.org/2005/08/addressing/anonymous\n    </a:Address>\n  </a:ReplyTo>\n  <a:To s:mustUnderstand="1" id="ccr-cep-proxy-url">\n  </a:To>\n  </s:Header>\n  <s:Body\n      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n      xmlns:xsd="http://www.w3.org/2001/XMLSchema">\n    <GetPolicies\n        xmlns="http://schemas.microsoft.com/windows/pki/2009/01/enrollmentpolicy">\n      <client>\n        <lastUpdate>0001-01-01T00:00:00</lastUpdate>\n        <preferredLanguage xsi:nil="true"></preferredLanguage>\n      </client>\n      <requestFilter xsi:nil="true"></requestFilter>\n    </GetPolicies>\n  </s:Body>\n</s:Envelope>\n'),Yb=
R('\n<o:Security\n    xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"\n    xmlns:s="http://www.w3.org/2003/05/soap-envelope"\n    xmlns:u="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"\n    s:mustUnderstand="1">\n  <o:UsernameToken u:Id="uuid-12df19ba-93db-4f41-8d7e-8bb789168bf9-1">\n    <o:Username id="ccr-basic-auth-username">\n    </o:Username>\n    <o:Password id="ccr-basic-auth-password">\n    </o:Password>\n  </o:UsernameToken>\n</o:Security>\n');
R('\n<GetPolicies\n    xmlns="http://schemas.microsoft.com/windows/pki/2009/01/enrollmentpolicy"\n    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n  <client>\n    <lastUpdate>0001-01-01T00:00:00</lastUpdate>\n    <preferredLanguage xsi:nil="true"></preferredLanguage>\n  </client>\n  <requestFilter xsi:nil="true"></requestFilter>\n</GetPolicies>\n');var $b=function(a,b){var c=new DOMParser;c=W(c,S(I("String literal."),Zb),"application/xml");c.getElementById("ccr-basic-auth-username").textContent=a;c.getElementById("ccr-basic-auth-password").textContent=b;return C(c.firstElementChild)},Y=function(a,b,c,d){V.call(this,a,b,d);this.certRequestValuesService_=c;this.isCurrentRequestPending=this.hasEnrolledSuccessfully=!1;this.currentRequestUri=this.currentRequestId=this.currentCsr="";a={};this.subjectAttributeMap_=(a.CommonName="2.5.4.3",a.Country=
"2.5.4.6",a.DeviceSerialNumber="2.5.4.5",a.Locality="2.5.4.7",a.Organization="2.5.4.10",a.OrganizationUnit="2.5.4.11",a.State="2.5.4.8",a)};la(Y,V);f=Y.prototype;f.certHelper=function(a){return this.tokenService.getCurrentToken()?this.generateCsr_(a):null};f.getAdditionalSubjectTypesAndValues=function(a){var b=[];if("Subject"in a){a=a.Subject;for(var c in this.subjectAttributeMap_)c in a&&b.push(new window.org.pkijs.simpl.ATTR_TYPE_AND_VALUE({type:this.subjectAttributeMap_[c],value:new window.org.pkijs.asn1.UTF8STRING({value:a[c]})}))}return b};
f.makeValidIA5String=function(a){return a.replace(/[^\x00-\x7F]/g,"")};f.mapIA5StringSubjectAltName=function(a,b){if(!(a in ac))return null;var c=ac[a],d=this.makeValidIA5String(b);b!=d&&Q("SAN value for NameType:"+a+" was not a valid IA5String - filtered",eb,this.managedPolicy.getLogLevel());return new window.org.pkijs.simpl.GENERAL_NAME({NameType:c,Name:d})};
f.createGeneralNameWithOtherName=function(a,b){a=new window.org.pkijs.asn1.SEQUENCE({value:[new window.org.pkijs.asn1.OID({value:a}),new window.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[b]})]});a=new window.org.pkijs.simpl.GENERAL_NAME({NameType:0,Name:a.value_block});a.NameType=0;return a};
f.mapWellKnownOtherName=function(a,b){return"userPrincipalName"==a?this.createGeneralNameWithOtherName("1.3.6.1.4.1.311.20.2.3",new window.org.pkijs.asn1.UTF8STRING({value:b})):null};
f.createSubjectAltNameExtension=function(a){if(!("SubjectAlternativeNames"in a))return null;a=a.SubjectAlternativeNames;for(var b=[],c=0;c<a.length;++c){var d=a[c].NameType,e=a[c].Name,g=this.mapIA5StringSubjectAltName(d,e);g||(g=this.mapWellKnownOtherName(d,e));g?b.push(g):Q("Skipping unsupport SAN NameType:"+d,eb,this.managedPolicy.getLogLevel())}return 0==b.length?null:new window.org.pkijs.simpl.EXTENSION({extnID:"2.5.29.17",critical:!1,extnValue:(new window.org.pkijs.simpl.GENERAL_NAMES({names:b})).toSchema().toBER(!1)})};
f.getAdditionalExtensions=function(a){var b=[];(a=this.createSubjectAltNameExtension(a))&&b.push(a);return b};
f.generateCsr_=function(a,b){var c=this,d=this.JSC$2830_q.defer(),e=this.JSC$2830_q.defer(),g=e.promise;e.resolve();var h=new window.org.pkijs.simpl.PKCS10;h.version=0;h.attributes=[];var l=this.managedPolicy.getSignatureAlgorithm(),k,m,n=this.tokenService.getCurrentToken().subtleCrypto,q=window.crypto.subtle;window.org.pkijs.getCrypto=function(){return c.tokenService.getCurrentToken().subtleCrypto};var y=!1;e=function(t){y||(y=!0,t&&(c.JSC$2830_errorMessage=chrome.i18n.getMessage(t)),c.currentCsr=
"",d.reject());return d};g.then(function(){var t=window.org.pkijs.getAlgorithmParameters("RSASSA-PKCS1-V1_5","generatekey");"hash"in t.algorithm&&(t.algorithm.hash.name=l);return n.generateKey(t.algorithm,!1,t.usages)},e.bind(this,void 0)).then(function(t){k=t.publicKey;m=t.privateKey},e.bind(this,"saving_generate_key_failure")).then(function(){return h.subjectPublicKeyInfo.importKey(k)},e.bind(this,"saving_generate_extract_failure")).then(function(){return q.digest({name:"SHA-1"},h.subjectPublicKeyInfo.subjectPublicKey.value_block.value_hex)},
e.bind(this,"saving_generate_export_failure")).then(function(t){c.subjectPublicKeyDigestResult_=t;return c.certRequestValuesService_.getCertRequestValues("system"==c.tokenService.getCurrentTokenType())},e.bind(this,"saving_generate_digest_failure")).then(function(t){var D=[];D.push(new window.org.pkijs.simpl.EXTENSION({extnID:"1.3.6.1.4.1.311.20.2",critical:!1,extnValue:(new window.org.pkijs.asn1.BMPSTRING({value:a})).toBER(!1)}));D.push(new window.org.pkijs.simpl.EXTENSION({extnID:"2.5.29.14",critical:!1,
extnValue:(new window.org.pkijs.asn1.OCTETSTRING({value_hex:c.subjectPublicKeyDigestResult_})).toBER(!1)}));b&&h.attributes.push(new window.org.pkijs.simpl.ATTRIBUTE({type:"1.3.6.1.4.1.311.13.1",values:[b.toSchema(!1)]}));Array.prototype.push.apply(D,c.getAdditionalExtensions(t));h.attributes.push(new window.org.pkijs.simpl.ATTRIBUTE({type:"1.2.840.113549.1.9.14",values:[(new window.org.pkijs.simpl.EXTENSIONS({extensions_array:D})).toSchema()]}));Array.prototype.push.apply(h.subject.types_and_values,
c.getAdditionalSubjectTypesAndValues(t))},e.bind(this,"saving_cert_request_values_failure")).then(function(){return h.sign(m,l)},e.bind(this,"saving_generate_push_failure")).then(function(){var t=h.toSchema().toBER(!1);c.currentCsr=window.btoa(gb(t));d.resolve()},e.bind(this,"saving_generate_sign_failure"));return d.promise};f.getKeyPair_=function(a,b){return new Promise(function(c,d){try{chrome.platformKeys.getKeyPair(a,b,function(e,g){chrome.runtime.lastError?d(chrome.runtime.lastError):c([e,g])})}catch(e){d(e)}})};
f.generateCsrForRenewal_=function(a,b){var c=this,d,e,g,h,l,k,m,n,q,y,t,D;return v(function(w){switch(w.nextAddress){case 1:return d=c.managedPolicy.getSignatureAlgorithm(),h=window.org.pkijs.getCrypto,window.org.pkijs.getCrypto=function(){return c.tokenService.getCurrentToken().subtleCrypto},l={name:"RSASSA-PKCS1-v1_5",hash:{name:d}},k=function(wb){window.org.pkijs.getCrypto=h;c.currentCsr="";wb&&(c.JSC$2830_errorMessage=chrome.i18n.getMessage(wb))},w.setCatchFinallyBlocks(2),w.yield(c.getKeyPair_(b.toSchema(!1).toBER(),
l),4);case 4:m=w.yieldResult;e=m[1];w.leaveTryBlock(3);break;case 2:return w.enterCatchBlock(),k("renewal_request_key_pair_failure"),w.return(Promise.reject());case 3:return w.setCatchFinallyBlocks(5),w.yield(c.generateCsr_(a,b),7);case 7:w.leaveTryBlock(6);break;case 5:return w.enterCatchBlock(),k("renewal_generate_pkcs10_failure"),w.return(Promise.reject());case 6:return n=hb(window.atob(c.currentCsr)),g=new window.org.pkijs.simpl.CMS_SIGNED_DATA({encapContentInfo:new window.org.pkijs.simpl.cms.EncapsulatedContentInfo({eContentType:"1.2.840.113549.1.7.1",
eContent:new window.org.pkijs.asn1.OCTETSTRING({name:"eContent",value_hex:n})}),signerInfos:[new window.org.pkijs.simpl.CMS_SIGNER_INFO({version:1,sid:new window.org.pkijs.simpl.cms.IssuerAndSerialNumber({issuer:b.issuer,serialNumber:b.serialNumber})})],certificates:[b]}),w.setCatchFinallyBlocks(8),w.yield(g.sign(e,0,d,null),10);case 10:w.leaveTryBlock(9);break;case 8:return q=w.enterCatchBlock(),Q(q,N,c.managedPolicy.getLogLevel()),k("renewal_sign_cms_failure"),w.return(Promise.reject());case 9:g.signerInfos[0].signatureAlgorithm=
new window.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:"1.2.840.113549.1.1.1",algorithm_params:new window.org.pkijs.asn1.NULL}),y=new window.org.pkijs.simpl.CMS_CONTENT_INFO({contentType:"1.2.840.113549.1.7.2",content:g.toSchema()}),t=y.toSchema(),D=t.toBER(!1),c.currentCsr=window.btoa(gb(D)),window.org.pkijs.getCrypto=h,w.jumpToEnd()}})};
f.enroll=function(a,b,c,d){var e=this,g=this.JSC$2830_q.defer();if(0==d.length)return this.hasEnrolledSuccessfully=!1,this.hasSpecificError=!0,this.JSC$2830_errorMessage=chrome.i18n.getMessage("login_no_uri_failure"),Q(this.JSC$2830_errorMessage,N,this.managedPolicy.getLogLevel()),g.reject(),g.promise;d=this.certHelper(d[0]);if(null===d)return this.hasEnrolledSuccessfully=!1,g.reject(),g.promise;d.then(function(){if(""==e.currentCsr)e.hasEnrolledSuccessfully=!1,Q(e.JSC$2830_errorMessage,N,e.managedPolicy.getLogLevel()),
g.reject();else{var h=new XMLHttpRequest;h.open("POST",a,!0,b,c);var l=new DOMParser,k=W(l,S(I("String literal."),bc),"application/xml");k.getElementById("ccr-cep-proxy-url").textContent=a;l=W(l,S(I("String literal."),cc),"application/xml");l.getElementById("ccr-certificate-request").textContent=e.currentCsr;k.getElementById("ccr-body").appendChild(l.firstElementChild);"basic"===e.managedPolicy.getClientAuthentication()&&(b=C(b),c=C(c),k.getElementById("ccr-header").appendChild($b(b,c)));ub(k);k=
(new XMLSerializer).serializeToString(k);h.withCredentials=!0;h.setRequestHeader("Content-type","application/soap+xml; charset=utf-8");h.onreadystatechange=function(){4==h.readyState&&(200==h.status?(e.enrollSuccessCallback(h.responseText),e.isEnrolledSuccessfully()||e.isRequestPending()?g.resolve():g.reject()):(e.enrollFailureCallback(h.responseText,h.statusText),g.reject()))};h.timeout=e.managedPolicy.getXhrRequestTimeout();h.ontimeout=function(){h.abort();e.hasEnrolledSuccessfully=!1;e.hasSpecificError=
!0;e.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_timeout_error");Q(e.JSC$2830_errorMessage,N,e.managedPolicy.getLogLevel());g.reject()};h.send(k)}},function(){g.reject()});return g.promise};
f.renewCertificate=function(a,b){var c=this,d,e;return v(function(g){switch(g.nextAddress){case 1:d="system"==c.tokenService.getCurrentTokenType()?c.managedPolicy.getDeviceEnrollmentTemplates():c.managedPolicy.getUserEnrollmentTemplates();if(!c.tokenService.getCurrentToken()||0==d.length)return Q("No template found for key-based renewal.",N,c.managedPolicy.getLogLevel()),c.hasEnrolledSuccessfully=!1,g.return(Promise.reject());g.setCatchFinallyBlocks(2);return g.yield(c.generateCsrForRenewal_(d[0],
b),4);case 4:g.leaveTryBlock(3);break;case 2:return e=g.enterCatchBlock(),Q("Generating CSR failed with the follwoing error: "+e,N,c.managedPolicy.getLogLevel()),c.hasEnrolledSuccessfully=!1,g.return(Promise.reject());case 3:return g.return(new Promise(function(h,l){var k=new XMLHttpRequest;k.open("POST",a,!0);var m=new DOMParser,n=W(m,S(I("String literal."),bc),"application/xml");n.getElementById("ccr-cep-proxy-url").textContent=a;m=W(m,S(I("String literal."),cc),"application/xml");m.getElementById("ccr-certificate-request").textContent=
c.currentCsr;n.getElementById("ccr-body").appendChild(m.firstElementChild);ub(n);n=(new XMLSerializer).serializeToString(n);k.withCredentials=!1;k.setRequestHeader("Content-type","application/soap+xml; charset=utf-8");k.onreadystatechange=function(){4==k.readyState&&(200==k.status?(c.enrollSuccessCallback(k.responseText),c.isEnrolledSuccessfully()||c.isRequestPending()?h():l()):(Q("Server rejected the renewal request with error: "+k.responseText,N,c.managedPolicy.getLogLevel()),c.enrollFailureCallback(k.responseText,
k.statusText),l()))};k.timeout=c.managedPolicy.getXhrRequestTimeout();k.ontimeout=function(){k.abort();c.hasEnrolledSuccessfully=!1;c.hasSpecificError=!0;c.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_timeout_error");Q(c.JSC$2830_errorMessage,N,c.managedPolicy.getLogLevel());l()};k.send(n)}))}})};
f.checkPendingRequestStatus=function(a,b,c,d){var e=this,g=this.JSC$2830_q.defer();if(!this.tokenService.getCurrentToken())return this.hasEnrolledSuccessfully=!1,this.currentCsr="",g.reject(),g.promise;var h=new XMLHttpRequest;h.open("POST",a,!0,c,d);var l=new DOMParser,k=W(l,S(I("String literal."),bc),"application/xml");k.getElementById("ccr-cep-proxy-url").textContent=a;a=W(l,S(I("String literal."),dc),"application/xml");a.getElementById("ccr-request-id").textContent=b;k.getElementById("ccr-body").appendChild(a.firstElementChild);
"basic"===this.managedPolicy.getClientAuthentication()&&(c=C(c),d=C(d),k.getElementById("ccr-header").appendChild($b(c,d)));ub(k);b=(new XMLSerializer).serializeToString(k);h.withCredentials=!0;h.setRequestHeader("Content-type","application/soap+xml; charset=utf-8");h.onreadystatechange=function(){4==h.readyState&&(200==h.status?(e.enrollSuccessCallback(h.responseText),e.isEnrolledSuccessfully()||e.isRequestPending()?g.resolve():g.reject()):(e.enrollFailureCallback(h.responseText,h.statusText),g.reject()))};
h.send(b);return g.promise};
f.enrollSuccessCallback=function(a){this.isCurrentRequestPending=this.hasEnrolledSuccessfully=!1;var b=new DOMParser,c=W(b,cb(a,null),"text/xml");a=ib(c,"DispositionMessage");b=a.slice(0,6);var d="";var e=c.getElementsByTagName("BinarySecurityToken");if(null!=e&&void 0!=e)for(var g=0;g<e.length;++g)if("http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"==e[g].getAttribute("ValueType")){d=e[g].innerHTML;break}if(null==d||void 0==d)d="";e=ib(c,"RequestID");g="";c=
c.getElementsByTagName("Reference");null!=c&&void 0!=c&&0!=c.length&&(g=c[c.length-1].getAttribute("URI"));if(null==g||void 0==g)g="";c=g;""!=d&&"Issued"==b?this.storeCertificate(d)?(Q("Successfully enrolled a certificate.",O,this.managedPolicy.getLogLevel()),this.hasEnrolledSuccessfully=!0):this.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_store_failure"):"Taken Under Submission"==a?(Q("Certificate is pending.",O,this.managedPolicy.getLogLevel()),Q("Pending certificate requestUri="+c+" and requestId="+
e,P,this.managedPolicy.getLogLevel()),this.isCurrentRequestPending=!0,this.currentRequestId=e,this.currentRequestUri=c,this.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_pending",[e,c])):this.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_no_cert_failure")};
f.enrollFailureCallback=function(a,b){this.hasEnrolledSuccessfully=!1;var c=new DOMParser;a=W(c,cb(a,null),"text/xml");var d=ib(a,"Text");c=d.slice(0,35);d=d.slice(0,6);"FailedAuthentication"===ib(a,"Value").slice(-20)?(this.hasSpecificError=!0,this.JSC$2830_errorMessage=chrome.i18n.getMessage("invalid_credentials")):"Denied by Policy Module  0x80094800"===c?(this.hasSpecificError=!0,this.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_template_error")):"Denied"===d?(this.hasSpecificError=!0,
this.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_denied")):(this.hasSpecificError=!1,this.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_bad_response",b));Q(this.JSC$2830_errorMessage,N,this.managedPolicy.getLogLevel())};
f.storeCertificate=function(a){var b=this;Q("Attempting to store a cert.",P,this.managedPolicy.getLogLevel());return 0<a.length?(a=hb(window.atob(a)),chrome.enterprise.platformKeys.importCertificate(this.tokenService.getCurrentToken().id,a,function(){rb(b.managedPolicy.isMachineCertEnrollmentAllowed(),b.managedPolicy.getHoursOffset(),b.managedPolicy.getNotificationInterval())}),!0):!1};f.isEnrolledSuccessfully=function(){return this.hasEnrolledSuccessfully};f.isRequestPending=function(){return this.isCurrentRequestPending};
f.getPendingRequestId=function(){return this.currentRequestId};f.getPendingRequestUri=function(){return this.currentRequestUri};Y.$inject=["managedPolicyService","tokenService","certRequestValuesService","$q"];
var bc=R('\n<s:Envelope xmlns:a="http://www.w3.org/2005/08/addressing"\n    xmlns:s="http://www.w3.org/2003/05/soap-envelope">\n  <s:Header id="ccr-header">\n    <a:Action s:mustUnderstand="1">\n      http://schemas.microsoft.com/windows/pki/2009/01/enrollment/RST/wstep\n    </a:Action>\n    <a:ReplyTo>\n      <a:Address>http://www.w3.org/2005/08/addressing/anonymous</a:Address>\n    </a:ReplyTo>\n    <a:To s:mustUnderstand="1" id="ccr-cep-proxy-url">\n    </a:To>\n  </s:Header>\n  <s:Body xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n      xmlns:xsd="http://www.w3.org/2001/XMLSchema"\n      id="ccr-body">\n  </s:Body>\n</s:Envelope>\n'),cc=
R('\n<RequestSecurityToken\n    xmlns="http://docs.oasis-open.org/ws-sx/ws-trust/200512">\n  <TokenType>\n    http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\n  </TokenType>\n  <RequestType>\n    http://docs.oasis-open.org/ws-sx/ws-trust/200512/Issue\n  </RequestType>\n  <BinarySecurityToken\n      EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd#base64binary"\n      ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd#PKCS7"\n      xmlns="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" id="ccr-certificate-request">\n  </BinarySecurityToken>\n  <RequestID xsi:nil="true"\n      xmlns="http://schemas.microsoft.com/windows/pki/2009/01/enrollment"\n      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />\n</RequestSecurityToken>\n'),
Zb=R('\n<o:Security\n    xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"\n    xmlns:s="http://www.w3.org/2003/05/soap-envelope"\n    s:mustUnderstand="1">\n  <o:UsernameToken>\n    <o:Username id="ccr-basic-auth-username">\n    </o:Username>\n    <o:Password id="ccr-basic-auth-password">\n    </o:Password>\n  </o:UsernameToken>\n</o:Security>\n'),dc=R('\n<RequestSecurityToken\n    xmlns="http://docs.oasis-open.org/ws-sx/ws-trust/200512">\n  <TokenType>\n    http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\n  </TokenType>\n  <RequestType>\n    http://schemas.microsoft.com/windows/pki/2009/01/enrollment/QueryTokenStatus\n  </RequestType>\n  <RequestID\n      xmlns="http://schemas.microsoft.com/windows/pki/2009/01/enrollment"\n      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n      id="ccr-request-id">\n  </RequestID>\n</RequestSecurityToken>\n'),
ac={rfc822Name:1,dNSName:2,uniformResourceIdentifier:6};var ec=function(a,b,c,d,e,g){Y.call(this,a,b,c,g);this.JSC$2904_http_=e;this.verifiedAccessService_=d;this.chromeIdentityEmail_=""};la(ec,Y);f=ec.prototype;
f.enroll=function(a,b,c,d){var e=this,g=this.JSC$2830_q.defer(),h=this.certHelper(d[0]);if(null===h)return g.reject(),g.promise;h.then(function(){""==e.currentCsr?(e.hasEnrolledSuccessfully=!1,Q(e.JSC$2830_errorMessage,N,e.managedPolicy.getLogLevel()),g.reject()):e.verifiedAccessService_.makeCsrToken().then(function(){var l=e.verifiedAccessService_.getCsrToken();""==l?(e.setErrorBasedOnVerifiedAccess_(),g.reject()):e.setChromeIdentityEmail_().then(function(){e.postEnrollmentRequest_(a,b,c,d,l).then(function(){e.isEnrolledSuccessfully()||
e.isRequestPending()?g.resolve():g.reject()},function(){g.reject()})},function(){g.reject()})},function(){e.setErrorBasedOnVerifiedAccess_();g.reject()})},function(){g.reject()});return g.promise};
f.postEnrollmentRequest_=function(a,b,c,d,e){var g=this;return this.JSC$2904_http_.post(a,{adUsername:b,adPassword:c,templates:d,csrToken:e,expectedIdentity:this.chromeIdentityEmail_,vaSharedSecret:this.managedPolicy.getVerifiedAccessSharedSecret(),pkcsCsr:this.currentCsr,csrType:"pkcs10",shouldEnrollForMachine:this.tokenService.isCurrentTokenSystemType()},{withCredentials:!0,timeout:this.managedPolicy.getVerifiedAccessRequestTimeout(),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(h){g.enrollSuccessCallback(h.data.certificate)},
function(h){-1===h.status?g.JSC$2830_errorMessage=chrome.i18n.getMessage("cea_timed_out"):(h=h.data.error,g.isKeyForValidMessage_(h)?g.JSC$2830_errorMessage=chrome.i18n.getMessage(h):g.JSC$2830_errorMessage=chrome.i18n.getMessage("cea_error_other"));g.hasSpecificError=!0;g.hasEnrolledSuccessfully=!1})};
f.enrollSuccessCallback=function(a){this.isCurrentRequestPending=this.hasEnrolledSuccessfully=!1;""==a?this.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_no_cert_failure"):(this.hasEnrolledSuccessfully=a=this.storeCertificate(a),a||(this.JSC$2830_errorMessage=chrome.i18n.getMessage("saving_store_failure")))};
f.setErrorBasedOnVerifiedAccess_=function(){this.hasEnrolledSuccessfully=!1;this.hasSpecificError=this.verifiedAccessService_.isSpecificErrorPresent();this.JSC$2830_errorMessage=this.verifiedAccessService_.JSC$2832_getErrorMessage();Q(this.JSC$2830_errorMessage,N,this.managedPolicy.getLogLevel())};f.isKeyForValidMessage_=function(a){return""!=chrome.i18n.getMessage(a)};
f.setChromeIdentityEmail_=function(){var a=this,b=this.JSC$2830_q.defer(),c=b.promise;chrome.identity.getProfileUserInfo(function(d){a.chromeIdentityEmail_=d.email;b.resolve()});return c};ec.$inject="managedPolicyService tokenService certRequestValuesService verifiedAccessService $http $q".split(" ");var fc=function(a,b){this.JSC$2812_managedPolicy_=a;this.JSC$2812_q_=b;this.currentToken_=void 0;this.errorMessage_=this.tokenType_=""};f=fc.prototype;
f.setTokenFromPlatformKeys=function(a){var b=this,c=this.JSC$2812_q_.defer();void 0!=chrome.enterprise&&void 0!=chrome.enterprise.platformKeys?chrome.enterprise.platformKeys.getTokens(function(d){for(var e=void 0,g=void 0,h=0;h<d.length;h++)switch(d[h].id){case "user":e=d[h];break;case "system":g=d[h]}a?b.JSC$2812_managedPolicy_.isMachineCertEnrollmentAllowed()?void 0!=g?(b.currentToken_=g,b.tokenType_=gc.SYSTEM,c.resolve()):(b.errorMessage_=chrome.i18n.getMessage("token_no_system_failure"),b.currentToken_=
void 0,b.tokenType_="",c.reject()):(b.errorMessage_=chrome.i18n.getMessage("token_system_unallowed_failure"),b.currentToken_=void 0,b.tokenType_="",c.reject()):void 0!=e?(b.currentToken_=e,b.tokenType_=gc.USER,c.resolve()):(b.errorMessage_=chrome.i18n.getMessage("token_no_user_failure"),b.currentToken_=void 0,b.tokenType_="",c.reject())}):(this.errorMessage_=chrome.i18n.getMessage("token_no_user_failure"),this.currentToken_=void 0,this.tokenType_="",c.reject());return c.promise};
f.getCurrentToken=function(){return this.currentToken_};f.getCurrentTokenType=function(){return this.tokenType_};f.JSC$2913_getErrorMessage=function(){return this.errorMessage_};f.getMatchingTemplates=function(){return this.tokenType_===gc.USER?this.JSC$2812_managedPolicy_.getUserEnrollmentTemplates():this.tokenType_===gc.SYSTEM?this.JSC$2812_managedPolicy_.getDeviceEnrollmentTemplates():[]};f.isCurrentTokenSystemType=function(){return this.tokenType_===gc.SYSTEM};
fc.$inject=["managedPolicyService","$q"];var gc={USER:"user",SYSTEM:"system"};var hc=function(a,b,c,d,e){V.call(this,a,b,e);this.JSC$2907_http_=c;this.csrToken_="";this.rawChallenge_={challenge:{data:"",signature:""}};this.encodedChallenge_=""};la(hc,V);f=hc.prototype;f.getCsrToken=function(){return this.csrToken_};
f.makeCsrToken=function(){var a=this,b=this.JSC$2830_q.defer();this.getChallengeFromEndpoint_().then(function(){a.encodedChallenge_=a.encodeChallenge_(a.rawChallenge_);a.generateChallengeResponse_(a.encodedChallenge_).then(function(){b.resolve()},function(){""==a.JSC$2830_errorMessage&&(a.JSC$2830_errorMessage=chrome.i18n.getMessage("generate_challenge_response_failed"));b.reject()})},function(){""==a.JSC$2830_errorMessage&&(a.JSC$2830_errorMessage=chrome.i18n.getMessage("get_challenge_failed"));
b.reject()});return b.promise};
f.getChallengeFromEndpoint_=function(){var a=this,b=this.managedPolicy.getApiKey(),c=this.managedPolicy.getVerifiedAccessUrl();if("https"!==c.slice(0,5)||""==b)return c=this.JSC$2830_q.defer(),b=c.promise,c.reject(),b;b=c+b;c={"Content-Type":"application/json; charset=utf-8","User-Agent":"CCRVA-"+chrome.runtime.getManifest().version+"-"+c};return this.JSC$2907_http_.post(b,{},{withCredentials:!0,timeout:this.managedPolicy.getVerifiedAccessRequestTimeout(),headers:c}).then(function(d){a.rawChallenge_=d.data},
function(d){a.JSC$2830_errorMessage=-1===d.status?chrome.i18n.getMessage("get_challenge_timed_out"):chrome.i18n.getMessage("get_challenge_failed");a.rawChallenge_={challenge:{data:"",signature:""}}})};
f.generateChallengeResponse_=function(a){var b=this,c=this.JSC$2830_q.defer(),d=c.promise;a=window.atob(a);a=hb(a);try{if(void 0!=chrome.enterprise&&void 0!=chrome.enterprise.platformKeys){var e=function(g){g=gb(g);b.csrToken_=window.btoa(g);c.resolve()};this.tokenService.isCurrentTokenSystemType()?chrome.enterprise.platformKeys.challengeMachineKey(a,e):chrome.enterprise.platformKeys.challengeUserKey(a,!0,e)}else this.JSC$2830_errorMessage=chrome.i18n.getMessage("cea_no_api_failure"),Q(this.JSC$2830_errorMessage,
N,this.managedPolicy.getLogLevel()),c.reject()}catch(g){this.JSC$2830_errorMessage=chrome.i18n.getMessage("generate_challenge_response_failed"),Q(this.JSC$2830_errorMessage,N,this.managedPolicy.getLogLevel()),Q(g.message,N,this.managedPolicy.getLogLevel()),c.reject()}return d};f.setSpecificError_=function(a){this.JSC$2830_errorMessage=a;this.hasSpecificError=!0};
f.encodeChallenge_=function(a){var b=window.atob(a.challenge.data);a=window.atob(a.challenge.signature);var c="\n"+ic(b.length);c=c+b+"\u0012"+ic(a.length);c+=a;return window.btoa(c)};hc.$inject=["managedPolicyService","tokenService","$http","$timeout","$q"];function ic(a){return 127>=a?String.fromCharCode(a):String.fromCharCode(128+(a&127),a>>>7)};var Z=angular.module("ccrApp.services",[]);Z.service("managedPolicyService",Cb);Z.service("requestService",V);Z.service("certificatePolicyService",Wb);Z.service("certificateSavingService",Y);Z.service("tokenService",fc);Z.service("verifiedAccessService",hc);Z.service("enrollmentAgentService",ec);Z.service("certRequestValuesService",Ub);angular.module("ccrApp.directives",[]);angular.module("ccrApp.controllers",["ngRoute","ngSanitize","ccrApp.services"]).controller("ccr.controllers.LoginPageCtrl",U);
angular.module("ccrApp",["ngMaterial","ccrApp.services","ccrApp.directives","ccrApp.controllers"]);var jc=document.getElementById("angular-bootstrap");angular.element(jc).ready(function(){var a=document.getElementById("angular-bootstrap");a&&angular.bootstrap(a,["ccrApp"])});
